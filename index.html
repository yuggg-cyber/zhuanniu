<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8"/>
<title>zhuanniu</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- å¼•å…¥ ethers.js -->
<script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=-fa6TzmOQsjLz9Y7NFeGKPrVtRbKjXPp4rPlHlAa-O_iG7tB_AZL09ieYop0DkEo" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- =========================================================
     æ ·å¼éƒ¨åˆ†
     ========================================================= -->

<style>
    body {
      margin:0; display:flex; height:100vh; font-family:sans-serif;
    }
    nav {
      width:240px; border-right:1px solid #ccc; padding:20px; box-sizing:border-box;
      background:#fff; overflow-y:auto;
    }
    nav h2 {margin-top:0; font-size:18px;}
    nav button {
      display:block; width:100%; padding:10px; margin-bottom:10px;
      cursor:pointer; border:2px solid #bbb; border-radius:6px;
      background:#f6f6f6; text-align:left;
    }
    nav button.active {background:#0d6efd; color:#fff; border:2px solid #0d6efd;}
    main {flex:1; overflow:auto; position: relative;} /* main å¢åŠ  relative */
    section {display:none; min-height:100%; overflow:auto; padding:10px; box-sizing:border-box;}
    section.active {display:block;}
</style>

<style>
/* é’±åŒ…ç”Ÿæˆå™¨ä¸“ç”¨æ ·å¼ (Scope: #wallet-generator) */
/* ä¿®å¤ ID å†²çªï¼Œæ”¹ç”¨ #wallet-generator */
#wallet-generator {
    position: relative; /* å…³é”®ä¿®æ”¹ï¼šè®©ç»å¯¹å®šä½çš„é®ç½©å±‚åªç›¸å¯¹äºæœ¬åŒºåŸŸå®šä½ */
}

#wallet-generator .wg-container { max-width: 1100px; margin: 0 auto; }

/* ä¿®æ”¹ï¼šæç¤ºè¯ subtitle æ ·å¼ä¼˜åŒ– */
#wallet-generator .subtitle {
    font-size: 13px;
    color: #666;
    background: #f8f9fa;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #eee;
    margin-bottom: 25px;
    line-height: 1.6;
}
/* æš—é»‘æ¨¡å¼é€‚é… subtitle */
body.dark #wallet-generator .subtitle {
    background: #2a2a2a;
    color: #aaa;
    border-color: #444;
}

/* ä¿®æ”¹ï¼šèƒŒæ™¯è‰²ç”± #fafafa æ”¹ä¸º #fffï¼Œè¾¹æ¡†é¢œè‰²è°ƒæ•´ï¼Œæ·»åŠ é˜´å½±ä»¥åŒ¹é…å…¶ä»– .tool-card */
#wallet-generator .toolbar {
    background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px;
    display: flex; align-items: center; gap: 15px; margin-bottom: 25px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}
#wallet-generator .label { font-size: 14px; color: #333; font-weight: 500; }

/* ä¿®æ”¹ï¼šè¾¹æ¡†åŠ ç²—ä¸º 2pxï¼Œé¢œè‰²æ”¹ä¸º #bbbï¼ŒåŒ¹é…å…¨ç«™è¾“å…¥æ¡†é£æ ¼ */
#wallet-generator input[type="number"] { padding: 8px 12px; border: 2px solid #bbb; border-radius: 8px; width: 100px; font-size: 14px; background: #fafafa; }
#wallet-generator input:focus { border-color: #0d6efd; outline: none; background: #fff; }

/* ä¿®æ”¹ï¼šä¸»æŒ‰é’®é¢œè‰²æ”¹ä¸ºå…¨ç«™ç»Ÿä¸€çš„è“è‰² #0d6efd */
#wallet-generator .btn-black { background: #0d6efd; color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: all .2s; }
#wallet-generator .btn-black:hover { background: linear-gradient(90deg,#0d6efd,#0b5ed7); }
#wallet-generator .btn-black:disabled { opacity: 0.6; cursor: not-allowed; background: #ccc; }

#wallet-generator .btn-stop { background: #d93025; border-color: #d93025; display: none; }
#wallet-generator .btn-stop:hover { background: #b02a22; }

/* ä¿®æ”¹ï¼šæ¬¡è¦æŒ‰é’®é£æ ¼åŒ¹é…å…¨ç«™ .btn */
#wallet-generator .btn-outline { background: #f6f6f6; color: #111; border: 1px solid #bbb; padding: 10px 24px; border-radius: 8px; margin-left: auto; cursor: pointer; transition: background 0.2s; }
#wallet-generator .btn-outline:hover { background: #eaeaea; }
#wallet-generator .btn-outline:disabled { opacity: 0.5; cursor: not-allowed; }

#wallet-generator .toolbar-status { font-size: 14px; color: #666; margin-left: 5px; }
#wallet-generator .security-badge { font-size: 12px; padding: 4px 8px; border-radius: 4px; margin-left: 10px; font-weight: 600; }
#wallet-generator .bg-safe { background: #e6f4ea; color: #1e8e3e; }
#wallet-generator .bg-danger { background: #fce8e6; color: #d93025; }

#wallet-generator .table-wrapper { border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
#wallet-generator table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
#wallet-generator thead { background: #fafafa; }
#wallet-generator th { text-align: left; padding: 14px 16px; color: #555; font-weight: 600; border-bottom: 1px solid #eee; }
#wallet-generator th:nth-child(1) { width: 60px; } 
#wallet-generator th:nth-child(2) { width: 380px; } 
#wallet-generator th:nth-child(3) { width: 280px; }
#wallet-generator td { padding: 12px 16px; border-bottom: 1px solid #eee; color: #444; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height: 50px; }

#wallet-generator .copyable { cursor: pointer; transition: background 0.2s; border-radius: 4px; padding: 2px 4px; margin: -2px -4px; }
#wallet-generator .copyable:active { background: #e0e0e0; color: #000 !important; }
#wallet-generator .font-mono { font-family: "SFMono-Regular", Consolas, monospace; }
#wallet-generator .blur-text { color: transparent; text-shadow: 0 0 10px rgba(0,0,0,0.5); transition: all 0.3s ease; user-select: none; }
#wallet-generator .blur-text:hover { color: #333; text-shadow: none; user-select: auto; }

/* é®ç½©å±‚ä¿®æ”¹ï¼šä» fixed æ”¹ä¸º absoluteï¼Œä½¿å…¶åªé®æŒ¡ content åŒºåŸŸ */
#wg-networkOverlay {
    position: absolute; /* ä¿®æ”¹ç‚¹ */
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.98); 
    z-index: 50; /* è°ƒæ•´å±‚çº§ï¼Œç¡®ä¿åœ¨ section å†…å®¹ä¹‹ä¸Šå³å¯ */
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center; transition: opacity 0.3s;
}
/* åªæœ‰å½“ active æ—¶æ‰æ˜¾ç¤ºé®ç½©ï¼Œä¸”å¦‚æœ hidden ç±»å­˜åœ¨åˆ™éšè— */
#wallet-generator:not(.active) #wg-networkOverlay { display: none !important; }
#wg-networkOverlay.hidden { display: none !important; }

#wallet-generator .warning-icon { width: 64px; height: 64px; background: #333; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 24px; }
#wallet-generator .overlay-title { font-size: 26px; font-weight: 600; color: #111; margin-bottom: 12px; letter-spacing: -0.5px; }
#wallet-generator .overlay-desc { font-size: 15px; color: #666; max-width: 480px; line-height: 1.6; margin-bottom: 32px; }

#wallet-generator .btn-verify {
    background: #111; color: #fff; border: none; padding: 14px 36px; border-radius: 6px; font-size: 15px; cursor: pointer; font-weight: 500;
    transition: all 0.2s; display: flex; align-items: center; gap: 10px;
}
#wallet-generator .btn-verify:hover { background: #333; transform: translateY(-1px); }
#wallet-generator .btn-verify:active { transform: translateY(0); }
#wallet-generator .btn-verify:disabled { background: #ccc; cursor: not-allowed; transform: none; }
#wallet-generator .btn-verify.error { background: #d93025; animation: shake 0.4s ease-in-out; }

@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
#wallet-generator .spinner { width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; display: none; }

/* Dark Mode for Wallet Gen (ä¿®æ­£é¢œè‰²ä»¥åŒ¹é…å…¨ç«™æš—é»‘ä¸»é¢˜) */
body.dark #wallet-generator { background: #1e1e1e; color: #e5e5e5; }
body.dark #wallet-generator .toolbar { background: #2a2a2a; border-color: #444; box-shadow: none; }
body.dark #wallet-generator .label { color: #e5e5e5; }
/* ä¿®æ”¹ï¼šæš—é»‘æ¨¡å¼è¾“å…¥æ¡†åŒ¹é…å…¨ç«™ */
body.dark #wallet-generator input[type="number"] { background: #2e2e2e; border: 2px solid #444; color: #e5e5e5; }
body.dark #wallet-generator input[type="number"]:focus { border-color: #3399ff; background: #1e1e1e; }

/* ä¿®æ”¹ï¼šæš—é»‘æ¨¡å¼æŒ‰é’®åŒ¹é…å…¨ç«™ Accent Blue */
body.dark #wallet-generator .btn-black { background: #3399ff; color: #fff; }
body.dark #wallet-generator .btn-black:hover { background: #4da6ff; }
body.dark #wallet-generator .btn-outline { background: #333; color: #e5e5e5; border-color: #555; }
body.dark #wallet-generator .btn-outline:hover { background: #444; }

body.dark #wallet-generator .table-wrapper { border-color: #444; }
body.dark #wallet-generator table { background: #2a2a2a; }
body.dark #wallet-generator thead { background: #333; }
body.dark #wallet-generator th, body.dark #wallet-generator td { border-color: #444; color: #e5e5e5; }
body.dark #wallet-generator .blur-text:hover { color: #e5e5e5; }

/* Dark Mode Overlay */
body.dark #wg-networkOverlay { background: rgba(30, 30, 30, 0.98); }
body.dark #wallet-generator .warning-icon { background: #e5e5e5; color: #1e1e1e; }
body.dark #wallet-generator .overlay-title { color: #e5e5e5; }
body.dark #wallet-generator .overlay-desc { color: #aaa; }
body.dark #wallet-generator .btn-verify { background: #e5e5e5; color: #1e1e1e; }
body.dark #wallet-generator .btn-verify:hover { background: #fff; }
</style>

<style>
@keyframes colorBlink  {
  0%   { opacity: 1; }
  50%  { opacity: 0.4; }
  100% { opacity: 1; }
}
@keyframes colorBlink {
  0%   { color: #ff4d4f; transform: scale(1); }
  50%  { color: #000;    transform: scale(1.1); }
  100% { color: #ff4d4f; transform: scale(1); }
}
#sol-batch td:nth-child(2),
#sol-batch th:nth-child(2) {
  white-space: nowrap;
  max-width: 500px;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* ç¼©çª„ç¼–å·åˆ—ï¼Œæ”¾å®½åœ°å€åˆ— */
#sol-batch td:nth-child(1),
#sol-batch th:nth-child(1) {
  width: 40px;
  text-align: center;
}
#sol-batch td:nth-child(2),
#sol-batch th:nth-child(2) {
  white-space: nowrap;
  width: 600px;
}
@keyframes breatheBlink {
  0%   { color: #000; opacity: 1; }
  50%  { color: #999; opacity: 0.6; }
  100% { color: #000; opacity: 1; }
}
.code.blinking {
  animation: breatheBlink 1s infinite ease-in-out;
}
</style>

<style>
    body {
      background:#0b0b0b;
      color:#cce8cc;
      font-family:monospace;
      padding:16px;
    }
    .module {
      border: 2px solid #cce8cc;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    h3 {
      margin-top: 0;
    }
    button {
      margin-top: 8px;
      padding: 6px 12px;
      background:#2e2e2e;
      color:#cce8cc;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
    button:hover {
      background:#444;
    }
    .stats {
      margin-bottom: 6px;
      font-weight: bold;
    }
    #log {
      background:#000;
      color:#0f0;
      padding:10px;
      margin-top:20px;
      height:300px;
      overflow:auto;
      white-space:pre-wrap;
    }
</style>

<style>
    :root {
      --bg:#fff; --fg:#111; --muted:#666; --border:#e5e5e5;
      --btn-bg:#f6f6f6; --btn-fg:#111; --btn-hover:#eaeaea; --accent:#0d6efd;
      --area-bg:#fff; --code-color:#000;
    }
    #fa.dark {
      --bg:#121212; --fg:#e5e5e5; --muted:#a0a0a0; --border:#2d2d2d;
      --btn-bg:#232323; --btn-fg:#e5e5e5; --btn-hover:#2d2d2d; --accent:#4FC3F7;
      --area-bg:#161616; --code-color:#4FC3F7;
    }
    body{
      margin:0;padding:20px;
      background:var(--bg);color:var(--fg);
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial;
    }
    .container{display:flex;gap:20px}
    .left,.right{
      border:1px solid var(--border);
      padding:12px;border-radius:10px;
      background:var(--area-bg);
    }
    .left{flex:1}.right{flex:2}
    textarea{
      width:100%;height:400px;
      font:14px/1.4 ui-monospace,monospace;
      color:var(--fg);background:var(--area-bg);
      border:1px solid var(--border);border-radius:6px;
      padding:8px;box-sizing:border-box;
    }
    .btn{
      border:1px solid var(--border);
      background:var(--btn-bg);color:var(--btn-fg);
      border-radius:6px;padding:6px 12px;
      cursor:pointer;font-size:14px;
    }
    .btn:hover{background:var(--btn-hover)}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:12px;font-weight:600
    }
    table{width:100%;border-collapse:collapse;table-layout:fixed}
    th,td{padding:8px;border-bottom:1px solid var(--border);text-align:center}
    .code{font-weight:700;cursor:pointer;color:var(--code-color)}
    .code:hover{background:var(--btn-hover);border-radius:4px}
    /* æ·±è‰²æ¨¡å¼ä¸‹ç¼–å·é¢œè‰² */
    #fa.dark td:first-child {color: var(--code-color);font-weight:bold;}
    #fa:not(.dark) td:first-child {font-weight:bold;}
    .scaler{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .scale-btn,.theme-btn{
      border:1px solid var(--border);
      background:var(--btn-bg);color:var(--btn-fg);
      border-radius:6px;padding:6px 12px;
      cursor:pointer;font-size:14px;
    }
    .scale-btn.active,.theme-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    #toast-container{position:fixed;right:20px;bottom:20px;z-index:9999}
    .toast{
      background:rgba(0,0,0,0.8);color:#fff;padding:8px 14px;margin-top:8px;
      border-radius:6px;font-size:14px;
      animation:fadein .2s, fadeout .2s 1.3s;
    }
    @keyframes fadein{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeout{from{opacity:1}to{opacity:0}}
</style>

<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#666; --border:#e5e5e5;
    --btn-bg:#f6f6f6; --btn-fg:#111; --btn-hover:#eaeaea; --accent:#0d6efd;
    --area-bg:#fff;
  }
  body.dark{
    --bg:#121212; --fg:#e5e5e5; --muted:#a0a0a0; --border:#2d2d2d;
    --btn-bg:#232323; --btn-fg:#e5e5e5; --btn-hover:#2d2d2d; --accent:#4FC3F7;
    --area-bg:#161616;
  }
  body{margin:0; background:var(--bg); color:var(--fg);
       font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial;
       display:flex; height:100vh;}
  nav{width:200px; border-right:1px solid var(--border); padding:20px; box-sizing:border-box;}
  nav h2{font-size:18px; margin-bottom:16px}
  .nav-btn{display:block; width:100%; text-align:left;
           background:var(--btn-bg); color:var(--btn-fg); border:1px solid var(--border);
           border-radius:6px; padding:10px; margin-bottom:8px; cursor:pointer;}
  .nav-btn.active{background:var(--accent); color:#fff; border-color:var(--accent);}
  main{flex:1; padding:20px; overflow:auto;}
  .theme-btn{border:1px solid var(--border); background:var(--btn-bg); color:var(--btn-fg);
             padding:6px 10px; border-radius:8px; cursor:pointer}
  .card{border:1px solid var(--border); border-radius:10px; background:var(--area-bg); margin-bottom:20px;}
  .card .hd{padding:10px 12px; border-bottom:1px solid var(--border); font-weight:600}
  .card .bd{padding:12px}
  textarea,input[type="text"],input[type="number"]{
    width:100%; background:var(--area-bg); color:var(--fg);
    border:1px solid var(--border); border-radius:6px; padding:8px; margin-bottom:8px;
  }
  textarea{min-height:180px; font:14px/1.5 ui-monospace,monospace}
  .btnbar{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px}
  .btn{border:1px solid var(--border); background:var(--btn-bg); color:var(--btn-fg);
       padding:6px 12px; border-radius:6px; cursor:pointer}
  .btn:hover{background:var(--btn-hover)}
  .btn.primary{background:var(--accent); color:#fff; border-color:var(--accent)}
  .stat{font-size:12px; color:var(--muted); margin-bottom:8px}
  table{width:100%; border-collapse:collapse; table-layout:fixed;}
  th,td{border-bottom:1px solid var(--border); padding:6px 8px; text-align:left; word-break:break-all;}
  #toast{position:fixed; right:16px; bottom:16px; z-index:9999}
  .toast{background:rgba(0,0,0,.8); color:#fff; padding:6px 12px; border-radius:6px; margin-top:6px;
         font-size:14px; opacity:0; transition:opacity .2s}
  .toast.show{opacity:1}
  /* å¯†ç å¼ºåº¦æ¡ */
  .strength-bar{height:8px; border-radius:4px; background:#ddd; margin-bottom:8px; overflow:hidden}
  .strength-fill{height:100%; width:0; transition:width .3s}
  .weak{background:#e74c3c} .medium{background:#f39c12} .strong{background:#27ae60}
</style>

<style>
    /* === SOL tool light UI overrides === */
    #sol { background:#fff; color:#111; }
    #sol h2, #sol h3 { color:#111; font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial; }
    #sol .module {
      border:1px solid #dcdcdc;
      background:#fafafa;
      border-radius:8px;
      padding:12px;
    }
    #sol button {
      margin-top:8px;
      padding:6px 12px;
      background:#f6f6f6;
      color:#111;
      border:2px solid #bbb;
      border-radius:6px;
      cursor:pointer;
    }
    #sol button:hover { background:#eaeaea; }
    #sol .stats { color:#111; }
    #sol #log {
      background:#f9f9f9;
      color:#111;
      border:2px solid #bbb;
      border-radius:6px;
      padding:10px;
      margin-top:20px;
      height:300px;
      overflow:auto;
      white-space:pre-wrap;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
      font-size:13px;
    }
</style>

<style>
    nav button {
      background:#fff;
      color:#111;
      border:2px solid #bbb;
      transition:background 0.2s,color 0.2s;
    }
    nav button:hover { background:#f0f0f0; }
    nav button.active {
      background:#0d6efd;
      color:#fff;
      border:2px solid #0d6efd;
    }
    /* Global dark mode */
    body.dark {
      background:#121212;
      color:#e5e5e5;
    }
    body.dark nav { background:#1e1e1e; border-right:1px solid #333; }
    body.dark nav button { background:#2a2a2a; color:#e5e5e5; border:1px solid #444; }
    body.dark nav button.active { background:#0d6efd; color:#fff; }
    body.dark section { background:#1e1e1e; color:#e5e5e5; }
    body.dark #sol #log { background:#222; color:#e5e5e5; border:1px solid #444; }
</style>

<style>
    /* Dark mode overrides */
    body.dark #sol {
      background:#1e1e1e !important;
      color:#e5e5e5 !important;
    }
    body.dark #sol .module {
      background:#2a2a2a !important;
      border:1px solid #444 !important;
      color:#e5e5e5 !important;
    }
    body.dark #sol h2, body.dark #sol h3 { color:#e5e5e5 !important; }
    body.dark #sol button {
      background:#333 !important;
      color:#e5e5e5 !important;
      border:1px solid #555 !important;
    }
    body.dark #sol button:hover { background:#444 !important; }
    body.dark #sol #log {
      background:#222 !important;
      color:#90ee90 !important;
      border:1px solid #444 !important;
    }
    /* 2FA codes green */
    body.dark #fa td:first-child { color:#90ee90 !important; }
    body.dark #fa .code { color:#90ee90 !important; }
</style>

<style>
    .theme-toggle {
      display:inline-flex;align-items:center;justify-content:center;
      width:28px;height:28px;border-radius:6px;line-height:1;
      font-size:18px;margin-left:8px;user-select:none;cursor:pointer;
      border:2px solid #bbb;background:#fff;color:#111;
    }
    nav h2 { display:flex; align-items:center; gap:6px; }
    body.dark .theme-toggle { background:#2a2a2a; color:#e5e5e5; border-color:#444; }
    body.dark #sol, body.dark #sol * { color:#fff !important; }
</style>

<style>
.copy-toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(50, 50, 50, 0.9);
  color: #fff;
  padding: 10px 16px;
  border-radius: 12px;
  font-size: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  opacity: 0;
  transition: opacity 0.5s ease, transform 0.5s ease;
  transform: translateY(20px);
  z-index: 9999;
}
.copy-toast.show {
  opacity: 1;
  transform: translateY(0);
}
.copy-toast.hide {
  opacity: 0;
  transform: translateY(20px);
}
</style>

<style>
.tool-card {
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 2px 6px rgba(0,0,0,0.04);
}
.form-group { margin-bottom:16px; }
.form-group label {
  display:block;
  font-weight:500;
  margin-bottom:6px;
  color:#333;
}
.form-group input,
.form-group textarea,
.form-group select {
  width:100%;
  border:2px solid #bbb;
  border-radius:8px;
  padding:10px;
  font-size:14px;
  background:#fafafa;
  box-shadow:none;
  transition:border-color .2s, background .2s;
}
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  border:2px solid #0d6efd;
  outline:none;
  background:#fff;
}
.btn {
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 18px;
  cursor:pointer;
  transition:all .2s ease;
}
.btn:hover {
  background:linear-gradient(90deg,#0d6efd,#0b5ed7);
}
.btn:active {
  transform:scale(0.97);
}
</style>

<style>
input[type="text"],
input[type="number"],
select,
textarea {
  border:2px solid #bbb !important;
  border-radius:8px;
  padding:10px;
  font-size:14px;
  background:#fafafa;
}
input[type="text"]:focus,
input[type="number"]:focus,
select:focus,
textarea:focus {
  border:2px solid #0d6efd !important;
  outline:none;
  background:#fff;
}
input[type="radio"] {
  accent-color:#0d6efd;
  width:18px;
  height:18px;
  border:2px solid #bbb;
}
</style>

<style>
body.dark {
  background:#1e1e1e;
  color:#e5e5e5;
}
body.dark nav {
  background:#2a2a2a;
  border-right:1px solid #444;
}
body.dark nav button {
  color:#e5e5e5;
}
body.dark nav button.active {
  background:#333;
  color:#3399ff;
  border-left:4px solid #3399ff;
}
body.dark .tool-card {
  background:#2a2a2a;
  border:1px solid #444;
}
body.dark .form-group label {
  color:#aaa;
}
body.dark input[type="text"],
body.dark input[type="number"],
body.dark select,
body.dark textarea {
  background:#2e2e2e;
  border:2px solid #444;
  color:#e5e5e5;
}
body.dark input[type="text"]:focus,
body.dark input[type="number"]:focus,
body.dark select:focus,
body.dark textarea:focus {
  border:2px solid #3399ff;
  background:#1e1e1e;
}
body.dark input[type="radio"] {
  accent-color:#3399ff;
}
body.dark .btn {
  background:#3399ff;
}
body.dark .btn:hover {
  background:#4da6ff;
}
body.dark .copy-toast {
  background:#333;
  color:#fff;
}
</style>

<style>
nav hr {
  border:0;
  border-top:1px solid #eee;
  margin:4px 0;
}
body.dark nav hr {
  border-top:1px solid #444;
}
</style>

<style>
nav button {
  font-size:18px !important;
  font-weight:600 !important;
  font-family:"Microsoft YaHei","Segoe UI",sans-serif !important;
}
</style>

<style>
body.dark input[type="text"],
body.dark input[type="number"],
body.dark select,
body.dark textarea {
  background:#2e2e2e !important;
  border:2px solid #444 !important;
  color:#e5e5e5 !important;
}
body.dark input[type="text"]:focus,
body.dark input[type="number"]:focus,
body.dark select:focus,
body.dark textarea:focus {
  border:2px solid #3399ff !important;
  background:#2a2a2a !important;
}
</style>

<style>
body.dark #pane-affix #affixStr {
  background:#2e2e2e !important;
  border:2px solid #444 !important;
  color:#e5e5e5 !important;
}
body.dark #pane-affix #affixStr:focus {
  background:#2a2a2a !important;
  border:2px solid #3399ff !important;
  color:#e5e5e5 !important;
}
</style>

<style>
body.dark #pane-affix input[type="text"],
body.dark #pane-affix input[type="number"],
body.dark #pane-split input[type="text"],
body.dark #pane-split input[type="number"],
body.dark #pane-pass input[type="text"],
body.dark #pane-pass input[type="number"],
body.dark #pane-affix textarea,
body.dark #pane-split textarea,
body.dark #pane-pass textarea {
  background-color:#2e2e2e !important;
  color:#e5e5e5 !important;
  -webkit-text-fill-color:#e5e5e5 !important;
  box-shadow:inset 0 0 0px 1000px #2e2e2e !important;
  border:2px solid #444 !important;
}
body.dark #pane-affix input[type="text"]:focus,
body.dark #pane-affix input[type="number"]:focus,
body.dark #pane-split input[type="text"]:focus,
body.dark #pane-split input[type="number"]:focus,
body.dark #pane-pass input[type="text"]:focus,
body.dark #pane-pass input[type="number"]:focus,
body.dark #pane-affix textarea:focus,
body.dark #pane-split textarea:focus,
body.dark #pane-pass textarea:focus {
  background-color:#2a2a2a !important;
  box-shadow:inset 0 0 0px 1000px #2a2a2a !important;
  border:2px solid #3399ff !important;
  color:#e5e5e5 !important;
  -webkit-text-fill-color:#e5e5e5 !important;
}
</style>

<style>
body.dark #sol-batch {
  background:#1e1e1e;
  color:#e5e5e5;
}
body.dark #sol-batch .card {
  background:#2a2a2a;
  border:1px solid #444;
}
body.dark #sol-batch table {
  background:#2a2a2a;
  color:#e5e5e5;
}
body.dark #sol-batch th, 
body.dark #sol-batch td {
  border-bottom:1px solid #444;
}
body.dark #sol-batch button {
  background:#333;
  color:#e5e5e5;
  border:1px solid #555;
}
body.dark #sol-batch button:hover {
  background:#444;
}
body.dark #sol-batch #toast {
  background:rgba(240,240,240,0.9);
  color:#000;
}
body.dark #sol-batch #retryFailedBtn {
  background:#3399ff;
  color:#fff;
}
</style>
<style>#sol-batch #retryFailedBtn{display:none;}</style>

<style>
#sol-batch .tag-success { color:#0f9d58; background:#e8f5e9; border:1px solid #b7e1cd; padding:4px 10px; border-radius:8px; font-size:12px; }
#sol-batch .tag-fail    { color:#d93025; background:#fdecea; border:1px solid #f5c2bf; padding:4px 10px; border-radius:8px; font-size:12px; }
#sol-batch .tag-wait    { color:#666;    background:#f0f0f0; border:1px solid #ccc;    padding:4px 10px; border-radius:8px; font-size:12px; }
#sol-batch #retryFailedBtn{ display:none; }
#sol-batch #runBtn,
#sol-batch #exportXlsxBtn,
#sol-batch #copyBtn,
#sol-batch #sortBtn,
#sol-batch #retryFailedBtn{
  background:#0d6efd; color:#fff; border:none; border-radius:8px; padding:10px 18px; cursor:pointer;
}
#sol-batch #runBtn:hover,
#sol-batch #exportXlsxBtn:hover,
#sol-batch #copyBtn:hover,
#sol-batch #sortBtn:hover,
#sol-batch #retryFailedBtn:hover{ background:linear-gradient(90deg,#0d6efd,#0b5ed7); }
#sol-batch #clearBtn{
  background:#f6f6f6; color:#111; border:1px solid #bbb; border-radius:8px; padding:10px 18px; cursor:pointer;
}
#sol-batch #clearBtn:hover{ background:#eaeaea; }

body.dark #sol-batch #clearBtn{ background:#333; color:#e5e5e5; border:1px solid #555; }
body.dark #sol-batch #clearBtn:hover{ background:#444; }
body.dark #sol-batch #runBtn,
body.dark #sol-batch #exportXlsxBtn,
body.dark #sol-batch #copyBtn,
body.dark #sol-batch #sortBtn,
body.dark #sol-batch #retryFailedBtn{ background:#3399ff; }
body.dark #sol-batch .tag-success { background:#1b4332; color:#90ee90; border-color:#2d6a4f; }
body.dark #sol-batch .tag-fail    { background:#5a1e1e; color:#ff6b6b; border-color:#8b0000; }
body.dark #sol-batch .tag-wait    { background:#333; color:#aaa; border-color:#555; }
</style>

<style>
    #sol-batch { margin:0; font-family:monospace; background:#f9f9f9; color:#111; }
    .wrap { max-width:960px; margin:0 auto; padding:30px; }
    #sol-batch label { font-size:14px; margin-top:16px; display:block; }
    .inline-label { display:inline-block !important; margin:0; }
    #sol-batch input,#sol-batch textarea,#sol-batch button {
      font-family:inherit; font-size:16px; padding:12px; margin-top:6px;
      border:1px solid #d9d9d9; border-radius:8px; background:#fff; color:#111;
    }
    #sol-batch input,#sol-batch textarea { width:100%; }
    #sol-batch textarea { min-height:220px; resize:vertical; font-size:15px; }
    #sol-batch button { cursor:pointer; width:auto; font-weight:bold; }
    .row { display:flex; gap:12px; align-items:center; margin-top:12px; flex-wrap:wrap; }
    .progress { height:14px; background:#eee; border-radius:6px; margin-top:14px; overflow:hidden; }
    .bar { height:100%; width:0; background:#4caf50; transition:width .2s ease; }
    #sol-batch table { width:100%; border-collapse:collapse; margin-top:18px; font-size:14px; background:#fff; }
    #sol-batch th,#sol-batch td { border-bottom:1px solid #e9e9e9; padding:10px; text-align:left; }
    #sol-batch tr:hover { background:#f3f3f3; }
    .muted { color:#666; font-size:13px; }
    .error-text { color:#d93025; font-weight:bold; }
    .card { background:#fff; padding:20px; border:1px solid #e6e6e6; border-radius:10px; margin-bottom:20px; }
    .tag {
      display:inline-block; padding:4px 10px; border-radius:8px; font-size:12px; line-height:1;
      border:1px solid transparent;
    }
    .tag-success { color:#0f9d58; background:#e8f5e9; border-color:#b7e1cd; padding:4px 10px; border-radius:8px; }
    .tag-wait { color:#666; background:#f0f0f0; border-color:#ccc; padding:2px 6px; border-radius:6px; }
    .tag-fail    { color:#d93025; background:#fdecea; border-color:#f5c2bf; padding:4px 10px; border-radius:8px; }

    #toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(50,50,50,0.9);
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 9999;
      font-size: 14px;
    }
    #toast.show { opacity: 1; }
    #retryFailedBtn {
      display:none;
      background:#007bff;
      color:#fff;
      border:none;
      padding:6px 12px;
      border-radius:6px;
      cursor:pointer;
    }
    #retryFailedBtn:hover {
      background:#0069d9;
    }
</style>

<style>
/* === SOLæ‰¹é‡æŸ¥è¯¢ æš—é»‘æ¨¡å¼æ”¯æŒ === */
body.dark #sol-batch { background:#1e1e1e; color:#e5e5e5; }
body.dark #sol-batch .card { background:#2a2a2a; border:1px solid #444; }
body.dark #sol-batch input,
body.dark #sol-batch textarea,
body.dark #sol-batch select {
  background:#2a2a2a; color:#eee; border:1px solid #555;
}
body.dark #sol-batch button {
  background:#333; color:#eee; border:1px solid #555;
}
body.dark #sol-batch button:hover { background:#444; }
body.dark #sol-batch table { background:#2a2a2a; color:#e5e5e5; }
body.dark #sol-batch th, body.dark #sol-batch td { border-color:#444; }
body.dark #sol-batch tr:hover { background:#333; }
body.dark #sol-batch .tag-success { background:#234d20; color:#90ee90; border-color:#2d6a4f; }
body.dark #sol-batch .tag-fail    { background:#5a1e1e; color:#ffb3b3; border-color:#8b0000; }
body.dark #sol-batch .tag-wait    { background:#333; color:#aaa; border-color:#555; }
</style>

<style>
/* === å®‰å…¨å¢é‡ï¼šæ‰‹æœºé€‚é… + ä¸‹æ‹‰èœå•ï¼ˆä¸ç ´ååŸç»“æ„ï¼‰ === */
@media (max-width: 768px) {
  body { flex-direction: column; height: auto; }
  nav {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid #ccc;
    padding: 10px;
    overflow: visible;
  }
  main { width: 100%; padding: 10px; }
  section { padding: 10px; }

  /* è¡¨æ ¼æ¨ªå‘æ»šåŠ¨ï¼Œé¿å…æŒ¤å‹ */
  table { display: block; overflow-x: auto; white-space: nowrap; }

  /* æŒ‰é’®åŒºåœ¨æ‰‹æœºä¸Šæ›´æ˜“ç‚¹ */
  .btnbar { flex-direction: column; gap: 6px; }
  textarea, input[type="text"], input[type="number"] { font-size: 14px; padding: 6px; }

  /* ä¸‹æ‹‰èœå• UI */
  .menu-toggle {
    display: inline-block;
    font-size: 20px;
    cursor: pointer;
    border: 1px solid #ccc;
    padding: 6px 10px;
    border-radius: 6px;
    background: #f6f6f6;
    margin-left: 8px;
  }
  .menu-items {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
  .menu-items.open { max-height: 1000px; }
  .menu-items button {
    display: block;
    width: 100%;
    margin: 6px 0;
    font-size: 14px;
    padding: 10px;
    text-align: left;
  }
}
</style>

<style id="mobile-noflash-patch">
@media (max-width: 768px) {
  nav > button,
  nav > hr {
    display: none !important;
  }
  .menu-items {
    display: none;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
  .menu-items.open {
    display: block;
    max-height: 1000px;
  }
  .menu-toggle {
    display: inline-block;
    font-size: 20px;
    cursor: pointer;
    border: 1px solid #ccc;
    padding: 6px 10px;
    border-radius: 6px;
    background: #f6f6f6;
    margin-left: 8px;
  }
}
</style>

<style>
/* ä¿®å¤ï¼šå¤œé—´æ¨¡å¼ä¸‹æ–‡æœ¬å·¥å…·åŒºä»ç„¶ç™½åº•çš„é—®é¢˜ */
body.dark #dedupe .card,
body.dark #affix .card,
body.dark #split .card,
body.dark #passwd .card {
  background:#2a2a2a !important;
  border:1px solid #444 !important;
  color:#e5e5e5 !important;
}

body.dark #dedupe textarea,
body.dark #affix textarea,
body.dark #split textarea,
body.dark #passwd textarea,
body.dark #dedupe input,
body.dark #affix input,
body.dark #split input,
body.dark #passwd input {
  background:#2e2e2e !important;
  border:2px solid #444 !important;
  color:#e5e5e5 !important;
  -webkit-text-fill-color:#e5e5e5 !important;
}

body.dark #dedupe textarea:focus,
body.dark #affix textarea:focus,
body.dark #split textarea:focus,
body.dark #passwd textarea:focus,
body.dark #dedupe input:focus,
body.dark #affix input:focus,
body.dark #split input:focus,
body.dark #passwd input:focus {
  background:#2a2a2a !important;
  border:2px solid #3399ff !important;
  color:#e5e5e5 !important;
}
</style>

<style>
body.dark #affix #affixStr,
body.dark #affix #affixStr:focus {
  background-color:#2e2e2e !important;
  border:2px solid #444 !important;
  color:#e5e5e5 !important;
  -webkit-text-fill-color:#e5e5e5 !important;
  box-shadow:none !important;
}
</style>

<style>
body.dark #affix #affixStr:-webkit-autofill {
  background-color:#2e2e2e !important;
  -webkit-box-shadow: 0 0 0px 1000px #2e2e2e inset !important;
  -webkit-text-fill-color:#e5e5e5 !important;
  border:2px solid #444 !important;
}
body.dark #affix #affixStr:-webkit-autofill:focus {
  background-color:#2a2a2a !important;
  -webkit-box-shadow: 0 0 0px 1000px #2a2a2a inset !important;
  -webkit-text-fill-color:#e5e5e5 !important;
  border:2px solid #3399ff !important;
}
</style>

<style>
body.dark #affix #affixStr,
body.dark #affix #affixStr:focus,
body.dark #affix #affixStr:-webkit-autofill,
body.dark #affix #affixStr:-webkit-autofill:focus,
body.dark #split #splitSep,
body.dark #split #splitSep:focus,
body.dark #split #splitSep:-webkit-autofill,
body.dark #split #splitSep:-webkit-autofill:focus {
  background-color:#2e2e2e !important;
  -webkit-box-shadow: 0 0 0px 1000px #2e2e2e inset !important;
  -webkit-text-fill-color:#e5e5e5 !important;
  border:2px solid #444 !important;
}
body.dark #affix #affixStr:focus,
body.dark #affix #affixStr:-webkit-autofill:focus,
body.dark #split #splitSep:focus,
body.dark #split #splitSep:-webkit-autofill:focus {
  background-color:#2a2a2a !important;
  -webkit-box-shadow: 0 0 0px 1000px #2a2a2a inset !important;
  border:2px solid #3399ff !important;
}
</style>

<style>
/* å›ºå®š 2FA éªŒè¯ç åˆ—è¡¨å¤åˆ¶æŒ‰é’®æ ·å¼ï¼šç°åº•ç™½å­—ï¼Œæ—¥å¤œæ¨¡å¼ä¸€è‡´ */
#fa td:last-child .btn {
  background:#666 !important;
  color:#fff !important;
  border:none !important;
}
#fa td:last-child .btn:hover {
  background:#555 !important;
  color:#fff !important;
}
</style>

<style>
/* å›ºå®š 2FA éªŒè¯ç åˆ—è¡¨å¤åˆ¶æŒ‰é’®æ ·å¼ï¼šæµ…ç°åº•é»‘å­—ï¼Œæ—¥å¤œæ¨¡å¼ä¸€è‡´ */
#fa td:last-child .btn {
  background:#ddd !important;
  color:#000 !important;
  border:none !important;
}
#fa td:last-child .btn:hover {
  background:#ccc !important;
  color:#000 !important;
}
</style>

<style>
/* å…¨å±€å³ä¸Šè§’ Toast æç¤ºæ ·å¼ */
#toast {
  visibility: hidden;
  min-width: 140px;
  max-width: 260px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 10px;
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  font-size: 14px;
}
#toast.show {
  visibility: visible;
  animation: fadein 0.3s, fadeout 0.3s 1.7s;
}
@keyframes fadein { from{opacity:0; right:0;} to{opacity:1; right:20px;} }
@keyframes fadeout { from{opacity:1; right:20px;} to{opacity:0; right:0;} }
</style>

<style>
/* === Global toast (top-right) === */
#toast-container-global{
  position:fixed;
  top:20px;
  right:20px;
  z-index:99999;
  display:flex;
  flex-direction:column;
  gap:8px;
  pointer-events:none; /* clicks pass through */
}
#toast-container-global .toast{
  background:rgba(0,0,0,0.85);
  color:#fff;
  padding:8px 12px;
  border-radius:8px;
  font-size:14px;
  opacity:0;
  transform:translateY(-6px);
  animation:toast-in .2s forwards, toast-out .2s 1.6s forwards;
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
  pointer-events:auto; /* allow selecting text if needed */
}
@keyframes toast-in{ to{ opacity:1; transform:translateY(0);} }
@keyframes toast-out{ to{ opacity:0; transform:translateY(-6px);} }
body.dark #toast-container-global .toast{ background:rgba(0,0,0,0.9); }
/* Hide legacy, per-section toast containers so they don't capture getElementById('toast') callers */
section #toast{ display:none !important; }
</style>

<!-- =========================================================
     æ–°å¢æ ·å¼ï¼šä¸ºäº†è®©æ–‡æœ¬å·¥å…·åœ¨ä¸€ä¸ªæ¡†é‡Œåˆ‡æ¢
     ä¿®æ”¹ç‚¹ï¼šå»æ‰äº† border-bottom (è“çº¿)ï¼Œè°ƒæ•´äº† textarea é«˜åº¦
     ========================================================= -->
<style>
    .tt-tabs {
      display: flex;
      gap: 5px;
      /* è¿™é‡Œå»æ‰äº†åŸå…ˆçš„ border-bottom: 2px solid #0d6efd; */
      border-bottom: none;
      margin-bottom: 15px;
      position: sticky; top: 0; background: inherit; z-index: 10; padding-top: 5px; flex-wrap:wrap;
    }
    .tt-tab {
      padding: 8px 16px;
      cursor: pointer;
      background: #f6f6f6;
      color: #111;
      border: 1px solid #ccc;
      border-bottom: none;
      border-radius: 6px 6px 0 0;
      font-size: 14px;
      font-weight: bold;
    }
    .tt-tab:hover { background: #eaeaea; }
    .tt-tab.active {
      background: #0d6efd;
      color: #fff;
      border-color: #0d6efd;
    }
    .tt-pane { display: none; }
    .tt-pane.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    
    /* æš—é»‘æ¨¡å¼é€‚é… */
    body.dark .tt-tab { background: #2a2a2a; border-color: #444; color: #aaa; }
    body.dark .tt-tab.active { background: #3399ff; color: #fff; border-color: #3399ff; }
    
    /* é’ˆå¯¹æš—é»‘æ¨¡å¼ä¿®æ­£æœ¬æ¨¡å— */
    body.dark #shuffle .card {
      background: #2a2a2a !important;
      border: 1px solid #444 !important;
      color: #e5e5e5 !important;
    }
    body.dark #shuffle textarea {
      background: #2e2e2e !important;
      border: 2px solid #444 !important;
      color: #e5e5e5 !important;
      -webkit-text-fill-color: #e5e5e5 !important;
    }

    /* é’ˆå¯¹æ–‡æœ¬å·¥å…·ç®±çš„è¾“å…¥è¾“å‡ºæ¡†é«˜åº¦è°ƒæ•´ */
    #text-tools textarea {
        min-height: 230px !important; /* åŸæ¥çº¦180pxï¼Œæ”¹ä¸º120px */
        height: 230px !important;
    }
</style>

<!-- å¯†ç ç”Ÿæˆå™¨çš„æ–°æ ·å¼ -->
<style>
.pwd-layout-container {
  display: grid;
  grid-template-columns: 320px 480px; /* å·²ä¿®æ”¹ï¼šå³ä¾§å›ºå®šå®½åº¦ä¸º480pxï¼Œä¸å†æ’‘æ»¡å…¨å± */
  gap: 20px;
}
@media (max-width: 768px) {
  .pwd-layout-container { grid-template-columns: 1fr; }
}
.pwd-opt-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px dashed #eee;
}
body.dark .pwd-opt-row { border-bottom-color: #333; }
.pwd-opt-row:last-child { border-bottom: 0; }

/* è‡ªå®šä¹‰æ»‘å— */
.pwd-range {
  -webkit-appearance: none; width: 100%; height: 6px; background: #ddd; border-radius: 3px; outline: none;
}
.pwd-range::-webkit-slider-thumb {
  -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #0d6efd; cursor: pointer;
}
body.dark .pwd-range { background: #444; }
body.dark .pwd-range::-webkit-slider-thumb { background: #3399ff; }

/* æ‰‹æœºå¼ Toggle å¼€å…³ */
.switch-toggle { position: relative; display: inline-block; width: 40px; height: 22px; }
.switch-toggle input { opacity: 0; width: 0; height: 0; }
.slider-toggle {
  position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc; transition: .4s; border-radius: 22px;
}
.slider-toggle:before {
  position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px;
  background-color: white; transition: .4s; border-radius: 50%;
}
input:checked + .slider-toggle { background-color: #0d6efd; }
body.dark input:checked + .slider-toggle { background-color: #3399ff; }
input:checked + .slider-toggle:before { transform: translateX(18px); }
body.dark .slider-toggle { background-color: #444; }
</style>

</head>
<body>
<script>
  // é˜²é—ªçƒè„šæœ¬ï¼šåœ¨é¡µé¢å†…å®¹æ¸²æŸ“å‰ç«‹å³æ‰§è¡Œ
  (function() {
    try {
      var saved = localStorage.getItem('tools_theme');
      // å¦‚æœæœ¬åœ°å­˜å‚¨æ˜¯ darkï¼Œæˆ–è€…æ²¡å­˜å‚¨ä½†ç³»ç»Ÿåå¥½æ˜¯æš—è‰²ï¼ˆå¯é€‰ï¼‰ï¼Œåˆ™ç«‹å³åŠ ä¸Š dark ç±»
      if (saved === 'dark') {
        document.body.classList.add('dark');
      }
    } catch(e) {}
  })();
</script>
<nav>
<h2>åŠŸèƒ½å¯¼èˆª <span aria-label="åˆ‡æ¢ä¸»é¢˜" class="theme-toggle" id="globalThemeToggle" role="button">ğŸŒ™</span>
<span class="menu-toggle">â‰¡</span>
</h2>
<div class="menu-items">
  <button data-tab="sol">SOLè´¦æˆ·</button><hr/>
  <button data-tab="sol-batch">SOLæŸ¥è¯¢</button><hr/>
  <button data-tab="fa">2FAéªŒè¯</button><hr/>
  <button data-tab="text-tools">æ–‡æœ¬å·¥å…·</button><hr/>
  <button data-tab="passwd">å¯†ç ç”Ÿæˆ</button><hr/>
  <button data-tab="koala">ç¡¬å¸çœ‹æ¿</button><hr/>
  <button data-tab="wallet-generator">é’±åŒ…ç”Ÿæˆ</button>
</div>
</nav>

<main>
<section id="sol">
<h2>ğŸ”¥ Solana Token Manager (Batch Burn &amp; Close)</h2>
<button id="connectBtn">è¿æ¥é’±åŒ…</button><span id="wallet">æœªè¿æ¥</span>
<!-- ç‡ƒçƒ§ä»£å¸æ¨¡å— -->
<div class="module" id="burn-module">
<h3>ğŸ”¥ Burn Tokens</h3>
<div class="stats" id="burn-stats">éé›¶ä»£å¸è´¦æˆ·æ•°é‡: 0</div>
<div id="token-list"></div>
<button id="burn-all">ç‡ƒçƒ§é‡‘é¢ä¸º0ä»£å¸</button></div>
<!-- å…³é—­ç©ºè´¦æˆ·æ¨¡å— -->
<div class="module" id="close-module">
<h3>ğŸ—‘ Close Empty Token Accounts</h3>
<div class="stats" id="empty-stats">ç©ºè´¦æˆ·æ•°é‡: 0</div>
<div id="empty-token-list"></div>
<button id="close-empty">å…³é—­ç©ºè´¦æˆ·</button></div>
<pre id="log"></pre>
<script type="module">
    import {
      Connection, PublicKey, Transaction
    } from "https://esm.sh/@solana/web3.js";
    import {
      TOKEN_PROGRAM_ID, createBurnCheckedInstruction, createCloseAccountInstruction
    } from "https://esm.sh/@solana/spl-token";

    const RPC_URL = "https://mainnet.helius-rpc.com/?api-key=989d7cc1-be87-4b20-91d0-2fd136b55a74";
    const connection = new Connection(RPC_URL);

    let provider = null;
    let pubkey = null;

    function getProvider() {
      if (window.okxwallet?.solana) return window.okxwallet.solana;
      if (window.phantom?.solana) return window.phantom.solana;
      if (window.solana?.isPhantom) return window.solana;
      return null;
    }

    function log(msg) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += msg + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    document.getElementById("connectBtn").onclick = async () => {
      provider = getProvider();
      if (!provider) {
        log("æ²¡æœ‰æ£€æµ‹åˆ° OKX æˆ– Phantom é’±åŒ…æ’ä»¶ï¼");
        return;
      }
      try {
        const resp = await provider.connect();
        pubkey = resp.publicKey;
        document.getElementById("wallet").textContent = pubkey.toBase58();
        log("å·²è¿æ¥é’±åŒ…: " + pubkey.toBase58());
        await loadTokens();
        await loadEmptyAccounts();
      } catch (e) {
        log("è¿æ¥å¤±è´¥: " + e.message);
      }
    };

    // åŠ è½½éé›¶ä»£å¸è´¦æˆ·
    async function loadTokens() {
      const resp = await connection.getParsedTokenAccountsByOwner(pubkey, { programId: TOKEN_PROGRAM_ID });
      const listDiv = document.getElementById("token-list");
      listDiv.innerHTML = "";
      let count = 0;
      resp.value.forEach(({ pubkey: ata, account }) => {
        const info = account.data.parsed.info;
        const amount = info.tokenAmount.uiAmount;
        if (amount > 0) {
          count++;
          const div = document.createElement("div");
          div.textContent = `Mint: ${info.mint} | Amount: ${amount} | Account: ${ata.toBase58()}`;
          listDiv.appendChild(div);
        }
      });
      document.getElementById("burn-stats").textContent = `éé›¶ä»£å¸è´¦æˆ·æ•°é‡: ${count}`;
    }

    // åŠ è½½ä½™é¢ä¸º0ä»£å¸è´¦æˆ·
    async function loadEmptyAccounts() {
      const resp = await connection.getParsedTokenAccountsByOwner(pubkey, { programId: TOKEN_PROGRAM_ID });
      const listDiv = document.getElementById("empty-token-list");
      listDiv.innerHTML = "";
      let count = 0;
      resp.value.forEach(({ pubkey: ata, account }) => {
        const info = account.data.parsed.info;
        const amount = info.tokenAmount.uiAmount;
        if (amount === 0) {
          count++;
          const div = document.createElement("div");
          div.textContent = `Mint: ${info.mint} | Empty Account: ${ata.toBase58()}`;
          listDiv.appendChild(div);
        }
      });
      document.getElementById("empty-stats").textContent = `ç©ºè´¦æˆ·æ•°é‡: ${count}`;
    }

    // æ‰¹é‡ç‡ƒçƒ§ä»£å¸æ“ä½œ
    document.getElementById("burn-all").onclick = async () => {
      if (!provider || !pubkey) return log("è¯·å…ˆè¿æ¥é’±åŒ…");

      const resp = await connection.getParsedTokenAccountsByOwner(pubkey, { programId: TOKEN_PROGRAM_ID });
      const nonZeroAccounts = resp.value
        .filter(({ account }) => account.data.parsed.info.tokenAmount.uiAmount > 0)
        .map(({ pubkey, account }) => {
          const info = account.data.parsed.info;
          return {
            ata: new PublicKey(pubkey),
            mint: new PublicKey(info.mint),
            amount: BigInt(info.tokenAmount.amount),
            decimals: info.tokenAmount.decimals,
            uiAmount: info.tokenAmount.uiAmountString
          };
        });

      if (nonZeroAccounts.length === 0) return log("æ²¡æœ‰ä»£å¸å¯ç‡ƒçƒ§");

      const batchSize = 8; // æ¯æ‰¹æœ€å¤š 8 ä¸ªè´¦æˆ·
      for (let i = 0; i < nonZeroAccounts.length; i += batchSize) {
        const batch = nonZeroAccounts.slice(i, i + batchSize);
        const tx = new Transaction();
        batch.forEach(({ ata, mint, amount, decimals }) => {
          tx.add(createBurnCheckedInstruction(ata, mint, pubkey, amount, decimals));
        });

        tx.feePayer = pubkey;
        tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

        try {
          let sig;
          if (provider.signAndSendTransaction) {
            const resp = await provider.signAndSendTransaction(tx);
            sig = resp.signature;
          } else {
            const signed = await provider.signTransaction(tx);
            sig = await connection.sendRawTransaction(signed.serialize());
          }

          log(`âœ… æ‰¹é‡ç‡ƒçƒ§ ${batch.length} ä¸ªè´¦æˆ·æˆåŠŸ, äº¤æ˜“å“ˆå¸Œ: ${sig}`);
          log("ğŸ”— https://solscan.io/tx/" + sig);
        } catch (e) {
          log("âŒ æ‰¹é‡ç‡ƒçƒ§å¤±è´¥: " + e.message);
        }
      }

      await loadTokens();
      await loadEmptyAccounts();
    };

    // æ‰¹é‡å…³é—­ç©ºè´¦æˆ·æ“ä½œ
    document.getElementById("close-empty").onclick = async () => {
      if (!provider || !pubkey) return log("è¯·å…ˆè¿æ¥é’±åŒ…");

      const resp = await connection.getParsedTokenAccountsByOwner(pubkey, { programId: TOKEN_PROGRAM_ID });
      const emptyAccounts = resp.value
        .filter(({ account }) => account.data.parsed.info.tokenAmount.uiAmount === 0)
        .map(({ pubkey }) => new PublicKey(pubkey));

      if (emptyAccounts.length === 0) return log("æ²¡æœ‰ç©ºè´¦æˆ·å¯å…³é—­");

      const batchSize = 8; // æ¯æ‰¹æœ€å¤š 8 ä¸ªè´¦æˆ·
      for (let i = 0; i < emptyAccounts.length; i += batchSize) {
        const batch = emptyAccounts.slice(i, i + batchSize);
        const tx = new Transaction();
        batch.forEach(ata => tx.add(createCloseAccountInstruction(ata, pubkey, pubkey)));

        tx.feePayer = pubkey;
        tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

        try {
          let sig;
          if (provider.signAndSendTransaction) {
            const resp = await provider.signAndSendTransaction(tx);
            sig = resp.signature;
          } else {
            const signed = await provider.signTransaction(tx);
            sig = await connection.sendRawTransaction(signed.serialize());
          }

          log(`âœ… æ‰¹é‡å…³é—­ ${batch.length} ä¸ªè´¦æˆ·æˆåŠŸ, äº¤æ˜“å“ˆå¸Œ: ${sig}`);
          log("ğŸ”— https://solscan.io/tx/" + sig);
        } catch (e) {
          log("âŒ æ‰¹é‡å…³é—­å¤±è´¥: " + e.message);
        }
      }

      await loadEmptyAccounts();
      await loadTokens();
    };
  </script>
</section>

<section id="sol-batch">
<div class="wrap">
<div class="card">
<div class="row" style="margin-top:0;">
<label class="inline-label">RPC èŠ‚ç‚¹</label>
<button id="pingBtn">æµ‹é€Ÿ</button>
<span class="muted" id="latency"></span>
</div>
<input id="rpc" type="text" value="https://mainnet.helius-rpc.com/?api-key=989d7cc1-be87-4b20-91d0-2fd136b55a74"/>
<div class="row">
<div style="flex:1">
<label>æŸ¥è¯¢çº¿ç¨‹æ•°</label>
<input id="threads" max="10" min="1" type="number" value="2"/>
</div>
<div style="flex:1">
<label>å»¶è¿Ÿ (æ¯«ç§’)</label>
<input id="delay" max="5000" min="0" type="number" value="500"/>
</div>
</div>
<label>åœ°å€åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
<textarea id="list" placeholder=""></textarea>
<div class="row">
<button id="runBtn">å¼€å§‹æŸ¥è¯¢</button>
<button id="clearBtn">æ¸…ç©º</button>
<button disabled="" id="exportXlsxBtn">å¯¼å‡º Excel</button>
<button disabled="" id="copyBtn">å¤åˆ¶ç»“æœ</button>
<button disabled="" id="sortBtn">æŒ‰ä½™é¢æ’åº</button>
<button disabled="" id="retryFailedBtn">é‡è¯•å¤±è´¥åœ°å€</button>
</div>
<div class="progress"><div class="bar" id="bar"></div></div>
<div class="row muted">
<span>æœ‰æ•ˆåœ°å€ï¼š<span id="validCount">0</span></span>
<span>æˆåŠŸæ•°é‡ï¼š<span id="successCount">0</span></span>
<span>å¤±è´¥æ•°é‡ï¼š<span id="failCount">0</span></span>
<span>æ€»ä½™é¢ï¼š<span id="sumSol">0</span> SOL</span>
</div>
<div class="muted" id="msg"></div>
</div>
<div class="card" style="max-height:400px; overflow:auto;">
<table>
<thead>
<tr><th>#</th><th>åœ°å€</th><th>SOL</th><th>çŠ¶æ€</th></tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>
</section>

<section id="fa">
<div class="container">
<div class="left">
    <div class="header">
        <b>å¯†é’¥è¾“å…¥</b>
        <button id="memBtn" class="btn" style="margin-left:auto; font-size:12px; padding:4px 10px;">è®°å¿†æ¨¡å¼: å…³</button>
    </div>
    
    <div style="display:flex; gap:6px; margin-bottom:8px; align-items:center;">
        <button class="btn" onclick="pasteInput()">ç²˜è´´</button>
        <button class="btn" onclick="clearInput()">æ¸…ç©º</button>
        
        <button id="addBtn" class="btn btn-primary mem-auth-only" onclick="importToMemory()">æ·»åŠ </button>
        
        <div style="flex:1;"></div>

        <button id="clearMemBtn" class="btn btn-danger mem-auth-only" onclick="clearMemoryData()">æ¸…ç©ºåº“</button>
    </div>

    <textarea id="secretBox" placeholder="æ¯è¡Œä¸€ä¸ªå¯†é’¥" style="height:400px; box-sizing:border-box;"></textarea>
    
    <div class="scaler">
        <div style="display:flex; gap:4px;">
            <button class="scale-btn" data-font="1.2em" data-scale="100">å°</button>
            <button class="scale-btn" data-font="1.5em" data-scale="150">ä¸­</button>
            <button class="scale-btn" data-font="2em" data-scale="200">å¤§</button>
            <button class="scale-btn" data-font="3em" data-scale="300">è€</button>
        </div>
        
        <div class="bottom-actions mem-auth-flex">
            <button id="exportBtn" class="btn btn-sm" onclick="openExportModal()">å¯¼å‡º</button>
            <button id="restoreBtn" class="btn btn-sm" onclick="openRestoreModal()">æ¢å¤</button>
            <button id="lockBtn" class="btn btn-sm btn-lock" onclick="lockVault()">é”å®š</button>
        </div>
    </div>
</div>

<div class="right" id="fa-right-panel" style="display:flex; flex-direction:column; padding-bottom:0;">
    <div class="header" style="flex-shrink:0;">
        <b>éªŒè¯ç åˆ—è¡¨</b>
        <b>åˆ·æ–°å€’è®¡æ—¶ï¼š<span id="timer">--</span>s</b>
    </div>
    
    <div class="table-container" style="position:relative; flex:1; overflow:hidden; display:flex; flex-direction:column; min-height:500px;">
        <div style="flex:1; overflow-y:auto;">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th style="width:25%">
                            <span class="mode-normal">#</span>
                            <span class="mode-memory">å¤‡æ³¨<span class="header-hint">(å•å‡»ä¿®æ”¹)</span></span>
                        </th>
                        <th>éªŒè¯ç </th>
                        <th>å¯†é’¥</th>
                        <th style="width:90px">å¤åˆ¶</th>
                        <th class="mem-col" style="width:90px">åˆ é™¤</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="rightOverlay" class="overlay-container" style="display:none;">
            <div id="lockMessage" class="lock-box" style="display:none;">
                <div class="lock-icon">ğŸ”’</div>
                <h3 class="lock-title">å®‰å…¨é”å®šä¸­</h3>
                <p class="lock-desc">è¯·è¾“å…¥å¯†ç è§£é”æŸ¥çœ‹</p>
                
                <div class="lock-input-group">
                    <input type="password" id="unlockPass" class="lock-input" placeholder="è¾“å…¥å¯†ç ">
                    <button class="lock-btn" onclick="unlockVault()">è§£é”</button>
                </div>
                
                <div id="unlockError" class="lock-error" style="display:none;">å¯†ç é”™è¯¯</div>
                
                <div style="margin-top:25px;">
                    <a href="javascript:void(0)" onclick="resetVault()" class="lock-reset-link">å¿˜è®°å¯†ç ï¼Ÿé‡ç½®å¹¶æ¸…ç©ºæ•°æ®</a>
                </div>
            </div>

            <div id="emptyTip" style="display:none;">
                <div style="font-size:64px; margin-bottom:15px; opacity:0.2;">ğŸ‚</div>
                <p style="color:#999; font-size:15px;">éªŒè¯åº“ä¸ºç©º<br>è¯·åœ¨å·¦ä¾§è¾“å…¥åç‚¹å‡»â€œæ·»åŠ â€</p>
            </div>
        </div>
    </div>
</div>
</div>

<div id="riskModal" class="risk-modal-overlay">
    <div class="risk-modal">
        <div class="risk-title">âš ï¸ é£é™©æç¤º</div>
        <div class="risk-content">
            <p>å¯ç”¨åï¼Œå¯†é’¥å°†åŠ å¯†å­˜å‚¨äºæœ¬åœ°æµè§ˆå™¨ã€‚ä¸ºé˜²æ¸…ç†ç¼“å­˜å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·åŠ¡å¿…å®šæœŸå¤‡ä»½ã€‚</p>
            <p style="color:#d93025; font-weight:bold;">è¯·å‹¿åœ¨å…¬å…±ç”µè„‘æˆ–å…±äº«è®¾å¤‡ä¸Šä½¿ç”¨æ­¤æ¨¡å¼ï¼</p>
        </div>
        <div class="risk-footer">
            <label class="risk-check">
                <input type="checkbox" id="riskNoRemind"> æˆ‘å·²äº†è§£ï¼Œä¸å†æç¤º
            </label>
            
            <div id="riskInlineError" style="color:#d93025; font-size:13px; font-weight:bold; display:none; margin-bottom:10px; text-align:right;">
                è¯·å…ˆå‹¾é€‰ä¸Šé¢çš„é€‰é¡¹ï¼
            </div>

            <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" onclick="cancelMemSwitch()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmMemSwitch()">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>
</div>

<div id="setupModal" class="risk-modal-overlay">
    <div class="risk-modal">
        <div class="risk-title">è®¾ç½®è§£é”å¯†ç </div>
        <div class="risk-content">
            <p>æ‚¨çš„å¯†é’¥å°†ä½¿ç”¨ <b>AES-GCM</b> åŠ å¯†å­˜å‚¨ã€‚</p>
            <p style="color:#d93025; font-size:13px;">âš ï¸ è‹¥é—å¿˜å¯†ç ï¼Œæ•°æ®å°†æ— æ³•æ¢å¤ã€‚</p>
            <div style="margin-top:15px;">
                <input type="password" id="setupPass" class="modal-input big-input" placeholder="è®¾ç½®å¯†ç " style="width:100%; box-sizing:border-box;">
            </div>
            <div style="margin-top:10px; text-align:right;">
                <a href="javascript:void(0)" onclick="switchToRestoreSetup()" style="font-size:12px; color:#0d6efd; text-decoration:none;">å·²æœ‰å¤‡ä»½ï¼Ÿç‚¹å‡»æ¢å¤</a>
            </div>
        </div>
        <div class="risk-footer">
            <div id="setupInlineError" style="color:#d93025; font-size:13px; font-weight:bold; display:none; margin-bottom:10px; text-align:right;">
                å¯†ç ä¸èƒ½ä¸ºç©ºï¼
            </div>
            
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" onclick="cancelSetup()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmSetup()">ç¡®è®¤å¼€å¯</button>
            </div>
        </div>
    </div>
</div>

<div id="exportModal" class="risk-modal-overlay">
    <div class="risk-modal" style="width:400px;">
        <div class="risk-title">å¯¼å‡ºå¤‡ä»½æ•°æ®</div>
        <div class="risk-content">
            <p>è¯·å¤åˆ¶ä¸‹æ–¹åŠ å¯†å†…å®¹ï¼Œæˆ–ä¸‹è½½æ–‡ä»¶ä¿å­˜ã€‚</p>
            <textarea id="exportText" readonly style="width:100%; height:100px; font-size:12px; border:1px solid #ccc; border-radius:4px; resize:none; box-sizing:border-box; background:#f9f9f9; color:#666;"></textarea>
        </div>
        <div class="risk-footer">
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" onclick="closeExportModal()">å…³é—­</button>
                <button class="btn" onclick="downloadBackup()">ä¸‹è½½ .txt</button>
                <button class="btn btn-primary" onclick="copyBackup()">å¤åˆ¶å†…å®¹</button>
            </div>
        </div>
    </div>
</div>

<div id="restoreModal" class="risk-modal-overlay">
    <div class="risk-modal" style="width:400px;">
        <div class="risk-title">æ¢å¤å¤‡ä»½æ•°æ®</div>
        <div class="risk-content">
            <p style="color:#d93025; font-weight:bold;">âš ï¸ æ³¨æ„ï¼šæ­¤æ“ä½œå°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼</p>
            <p>è¯·ç²˜è´´ä¹‹å‰çš„å¤‡ä»½å†…å®¹ï¼š</p>
            <textarea id="restoreText" placeholder="ç²˜è´´åŠ å¯†çš„å¤‡ä»½æ•°æ®..." style="width:100%; height:80px; font-size:12px; border:1px solid #ccc; border-radius:4px; resize:none; box-sizing:border-box;"></textarea>
        </div>
        <div class="risk-footer">
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" onclick="closeRestoreModal()">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="confirmRestore()">è¦†ç›–å¹¶æ¢å¤</button>
            </div>
        </div>
    </div>
</div>

<div id="toast-container"></div>

<style>
    /* === Toast æç¤ºæ°”æ³¡æ ·å¼ === */
    #toast-container {
        position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
        z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none;
    }
    .toast-msg {
        background: rgba(0, 0, 0, 0.85); color: #fff; padding: 10px 20px; border-radius: 6px; font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: toastIn 0.3s ease-out, toastOut 0.3s ease-in 2.5s forwards;
        text-align: center; min-width: 150px; backdrop-filter: blur(4px);
    }
    @keyframes toastIn { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }
    @keyframes toastOut { to { opacity:0; transform: translateY(-20px); } }

    /* === é”å®šç•Œé¢æ ·å¼ === */
    .lock-box { width: 100%; max-width: 380px; text-align: center; }
    .lock-icon { font-size: 56px; margin-bottom: 20px; text-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: floatIcon 3s ease-in-out infinite; }
    @keyframes floatIcon { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
    .lock-title { font-size: 24px; color: #333; margin: 0 0 10px 0; font-weight: 700; letter-spacing: 1px; }
    .lock-desc { color: #888; font-size: 14px; margin-bottom: 25px; }
    .lock-input-group { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 15px; }
    .lock-input { width: 240px; height: 44px !important; padding: 0 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; outline: none; box-sizing: border-box !important; transition: all 0.2s; text-align: center; }
    .lock-input:focus { border-color: #0d6efd; box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.1); }
    .lock-btn { width: 240px; height: 44px !important; border: none; background: #0d6efd; color: #fff; font-size: 15px; font-weight: 500; cursor: pointer; border-radius: 4px; box-sizing: border-box !important; transition: background 0.2s; }
    .lock-btn:hover { background: #0b5ed7; }
    .lock-error { color: #d93025; font-size: 13px; margin-top: 15px; font-weight: bold; background: #fff5f5; display: inline-block; padding: 4px 12px; border-radius: 4px; border: 1px solid #ffebeb; }
    .lock-reset-link { font-size: 12px; color: #999; text-decoration: underline; transition: color .2s; }
    .lock-reset-link:hover { color: #d93025; }

    /* === å¸ƒå±€ä¸æ˜¾éšæ§åˆ¶ === */
    #fa .container { align-items: flex-start; }
    #fa .left { display: flex; flex-direction: column; }
    #fa .scaler { display: flex; align-items: center; justify-content: space-between; margin-top: 8px; flex-wrap: wrap; gap: 8px; }
    
    .mem-auth-only { display: none; }
    .bottom-actions { display: none; gap: 6px; }
    .mem-auth-flex { display: none; gap: 6px; }
    .mem-col { display: none; }
    
    #fa.is-memory-active.is-unlocked .mem-auth-only { display: inline-block; }
    #fa.is-memory-active.is-unlocked .mem-auth-flex { display: flex; }
    #fa.is-memory-active.is-unlocked .mem-col { display: table-cell; }

    .mode-memory { display: none; }
    .mode-normal { display: inline; }
    #fa.is-memory-active .mode-normal { display: none; }
    #fa.is-memory-active .mode-memory { display: inline; }

    /* æ ·å¼ */
    .btn-sm { padding: 4px 10px; font-size: 13px; }
    .btn-lock { border: 1px solid #d93025 !important; color: #d93025 !important; background: #fff !important; }
    .btn-lock:hover { background: #fce8e6 !important; }
    
    /* é«˜äº®è¡ŒèƒŒæ™¯è‰²åŠ æ·± */
    tr.highlighted-row td { background-color: #c0c0c0 !important; transition: background 0.2s; }
    
    .table-container { border-top: 1px solid #eee; }
    .big-input { height: 42px; padding: 0 12px; font-size: 16px; box-sizing: border-box; }
    .btn.mem-active { background: #0d6efd !important; color: #fff !important; border-color: #0d6efd !important; }

    .secret-mask { font-family: monospace; letter-spacing: 3px; cursor: pointer; color: #aaa; font-size: 16px; user-select: none; transition: color 0.2s; display: inline-block; padding: 2px 4px; }
    .secret-mask:hover { color: #0d6efd; }
    
    /* revealæ ·å¼ï¼Œç”¨äºæ™®é€šæ¨¡å¼é»˜è®¤æ˜¾ç¤º */
    .secret-revealed { font-family: monospace; color: #333; font-weight: bold; letter-spacing: 1px; cursor: pointer; background: #e9ecef; padding: 4px 10px; border-radius: 4px; font-size: 15px; display: inline-block; min-width: 80px; text-align: center; }

    .overlay-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; text-align: center; }
    .risk-modal-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: center; justify-content: center; border-radius: 8px; }
    .risk-modal { background: #fff; padding: 20px; border-radius: 8px; width: 320px; box-shadow: 0 4px 16px rgba(0,0,0,0.3); animation: popIn 0.2s ease; }
    .risk-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #333; }
    .risk-content { font-size: 14px; line-height: 1.5; color: #555; margin-bottom: 15px; }
    .risk-footer { border-top: 1px solid #eee; padding-top: 15px; }
    .risk-check { font-size: 13px; color: #666; display: block; margin-bottom: 10px; cursor: pointer; user-select: none; }
    
    #fa .btn-copy { background: #ddd !important; color: #000 !important; border: none !important; white-space: nowrap; }
    #fa .btn-copy:hover { background: #ccc !important; }
    #fa .btn-del { background: #fff; color: #d93025; border: 1px solid #f5c2bf; white-space: nowrap; }
    #fa .btn-del:hover { background: #fce8e6; border-color: #d93025; }
    #fa .btn-primary { background: #0d6efd; color: #fff; border: 1px solid #0d6efd; }
    #fa .btn-primary:hover { background: #0b5ed7; }
    #fa .btn-danger { background: #d93025; color: #fff; border: 1px solid #d93025; }
    #fa .btn-danger:hover { background: #b02a22; }
    
    /* æš—é»‘æ¨¡å¼é€‚é… */
    body.dark .lock-title { color: #fff; }
    body.dark .lock-input { background: #2a2a2a; border-color: #444; color: #fff; }
    body.dark .lock-input:focus { border-color: #3399ff; }
    body.dark .lock-btn { background: #3399ff; border-color: #3399ff; }
    body.dark .lock-btn:hover { background: #2b88d8; border-color: #2b88d8; }
    body.dark .lock-error { background: #3b1111; color: #ff6b6b; border-color: #5a1e1e; }
    body.dark .btn-lock { background: #2a2a2a !important; color: #ff6b6b !important; border-color: #8b0000 !important; }
    body.dark tr.highlighted-row td { background-color: #444 !important; }
    body.dark .table-container { border-top-color: #444; }
    body.dark .secret-revealed { color: #fff; background: #3a3a3a; }
    body.dark .overlay-container { background: rgba(22,22,22,0.98); }
    body.dark .risk-modal { background: #2a2a2a; color: #e5e5e5; }
    body.dark .risk-title { color: #fff; }
    body.dark .risk-content { color: #ccc; }
    body.dark .risk-footer { border-top-color: #444; }
    body.dark .risk-check { color: #aaa; }
    body.dark #fa .btn-del { background: #2a2a2a; color: #ff6b6b; border-color: #8b0000; }
    body.dark #fa .btn-del:hover { background: #5a1e1e; }
    body.dark #fa .btn-primary { background: #3399ff; border-color: #3399ff; }
    body.dark #fa .btn-danger { background: #ab0000; border-color: #ab0000; }

    @keyframes popIn { from{transform: scale(0.9); opacity:0;} to{transform: scale(1); opacity:1;} }
    .editable-cell { cursor: pointer; transition: color 0.2s; }
    .editable-cell:hover { color: #0d6efd; background: rgba(0,0,0,0.02); }
    .inline-edit { width: 100%; box-sizing: border-box; padding: 4px; border: 1px solid #0d6efd; border-radius: 4px; }
    .header-hint { font-size: 12px; font-weight: 400; color: #999; margin-left: 4px; }
    .modal-input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
</style>

<script>
    const b32map="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    function base32ToBytes(b32){
      let bits="",out=[]; b32=b32.toUpperCase().replace(/[^A-Z2-7]/g,"");
      for(const c of b32){const v=b32map.indexOf(c); if(v>=0) bits+=v.toString(2).padStart(5,"0");}
      for(let i=0;i+8<=bits.length;i+=8) out.push(parseInt(bits.slice(i,i+8),2));
      return new Uint8Array(out);
    }
    function counterToBytes(c){const b=new ArrayBuffer(8),v=new DataView(b); v.setUint32(0, Math.floor(c/0x100000000)); v.setUint32(4, c>>>0); return new Uint8Array(b);}
    async function hmacSHA1(key,msg){
      const k=await crypto.subtle.importKey("raw",key,{name:"HMAC",hash:"SHA-1"},false,["sign"]);
      return new Uint8Array(await crypto.subtle.sign("HMAC",k,msg));
    }
    async function genTOTP(secret,period=30,digits=6){
      const now=Math.floor(Date.now()/1000), step=Math.floor(now/period);
      const mac=await hmacSHA1(secret,counterToBytes(step));
      const off=mac[mac.length-1]&0xf;
      const bin=((mac[off]&0x7f)<<24)|(mac[off+1]<<16)|(mac[off+2]<<8)|(mac[off+3]);
      return String(bin%(10**digits)).padStart(digits,"0");
    }

    const CryptoUtils = {
        async deriveKey(password, salt) {
            const enc = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]);
            return crypto.subtle.deriveKey(
                { name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" },
                keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]
            );
        },
        async encrypt(dataObj, password) {
            const salt = crypto.getRandomValues(new Uint8Array(16));
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const key = await this.deriveKey(password, salt);
            const enc = new TextEncoder();
            const encoded = enc.encode(JSON.stringify(dataObj));
            const ciphertext = await crypto.subtle.encrypt({ name: "AES-GCM", iv: iv }, key, encoded);
            return JSON.stringify({
                salt: Array.from(salt),
                iv: Array.from(iv),
                data: Array.from(new Uint8Array(ciphertext))
            });
        },
        async decrypt(jsonStr, password) {
            try {
                const raw = JSON.parse(jsonStr);
                const salt = new Uint8Array(raw.salt);
                const iv = new Uint8Array(raw.iv);
                const data = new Uint8Array(raw.data);
                const key = await this.deriveKey(password, salt);
                const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, key, data);
                const dec = new TextDecoder();
                return JSON.parse(dec.decode(decrypted));
            } catch (e) {
                throw new Error("å¯†ç é”™è¯¯");
            }
        }
    };

    const period=30;
    let activeSecrets = [];
    let memoryStorage = []; 
    let currentMasterPass = null; 
    let codeFontSize="1.5em"; // [ä¿®æ”¹] å˜é‡é»˜è®¤å€¼æ”¹ä¸ºä¸­å·
    let isMemEnabled = false;

    const STORAGE_KEY_MEM_FLAG = "fa_mem_on_v2";
    const STORAGE_KEY_DATA_ENC = "fa_db_enc_v1";
    const STORAGE_KEY_RISK_READ = "fa_risk_read";

    const dom = {
        section: document.getElementById("fa"), 
        secretBox: document.getElementById("secretBox"),
        memBtn: document.getElementById("memBtn"),
        tbody: document.querySelector("#resultTable tbody"),
        overlay: document.getElementById("rightOverlay"),
        lockMsg: document.getElementById("lockMessage"),
        emptyTip: document.getElementById("emptyTip"),
        unlockPass: document.getElementById("unlockPass"),
        unlockErr: document.getElementById("unlockError"),
        setupModal: document.getElementById("setupModal"),
        setupPass: document.getElementById("setupPass"),
        exportModal: document.getElementById("exportModal"),
        exportText: document.getElementById("exportText"),
        restoreModal: document.getElementById("restoreModal"),
        restoreText: document.getElementById("restoreText"),
        riskModal: document.getElementById("riskModal"),
        riskCheck: document.getElementById("riskNoRemind"),
        riskInlineError: document.getElementById("riskInlineError"),
        setupInlineError: document.getElementById("setupInlineError")
    };
    function parseLine(line){
      const trimmed = line.trim();
      if(!trimmed) return null;
      if(/^otpauth:/i.test(trimmed)){
        try{
            const u=new URL(trimmed);
            const sec=u.searchParams.get("secret")||""; 
            let lbl = decodeURIComponent(u.pathname.replace(/^\/\/[^/]+\/|^\/[^/]+\/|^\//, ''));
            if(lbl.includes(':')) lbl = lbl.split(':').pop().trim();
            return { secret: sec, bytes: base32ToBytes(sec), label: lbl, raw: trimmed };
        } catch{ return null; }
      }
      try{
          return { secret: trimmed, bytes: base32ToBytes(trimmed), label: "", raw: trimmed };
      } catch{ return null; }
    }
    function updatePlaceholder() {
        if(isMemEnabled) dom.secretBox.placeholder = "æ¯è¡Œä¸€ä¸ªå¯†é’¥\nè¾“å…¥åç‚¹å‡»â€œæ·»åŠ â€æŒ‰é’®";
        else dom.secretBox.placeholder = "æ¯è¡Œä¸€ä¸ªå¯†é’¥";
    }

    function onInputChanged() {
        if (isMemEnabled) return;
        const lines = dom.secretBox.value.split(/\r?\n/);
        activeSecrets = lines.map((l, i) => {
            const p = parseLine(l);
            if(p) { p.label = (i+1).toString(); p.index = i; } 
            return p;
        }).filter(Boolean);
        refreshTable();
    }

    async function refreshTable() {
        dom.tbody.innerHTML = "";
        if (isMemEnabled) {
            dom.overlay.style.display = 'flex';
            if (!currentMasterPass) {
                dom.lockMsg.style.display = 'block';
                dom.emptyTip.style.display = 'none';
                return; 
            } else if (activeSecrets.length === 0) {
                dom.lockMsg.style.display = 'none';
                dom.emptyTip.style.display = 'block';
                return;
            } else {
                dom.overlay.style.display = 'none';
            }
        } else {
            dom.overlay.style.display = 'none';
        }

        for(let i=0; i<activeSecrets.length; i++) {
            const s = activeSecrets[i];
            let code = "ERROR";
            try {
                code = await genTOTP(s.bytes, period, 6);
            } catch(e) { console.warn("Invalid secret", s); }

            const tr = document.createElement("tr");
            let displayLabel = s.label;
            if(!displayLabel) displayLabel = (i+1).toString();

            const labelHtml = `<td class="editable-cell" title="ç‚¹å‡»ä¿®æ”¹å¤‡æ³¨" onclick="handleCellEdit(this, ${i})">${displayLabel}</td>`;
            const copyHtml = `<td><button class="btn btn-copy" onclick="copyCode('${code}')">å¤åˆ¶</button></td>`;
            const delHtml = `<td class="mem-col"><button class="btn btn-del" onclick="deleteRow(${i})">åˆ é™¤</button></td>`;
            
            // å¯†é’¥æ˜¾ç¤ºé€»è¾‘
            let secretHtml = '';
            if (isMemEnabled) {
                // è®°å¿†æ¨¡å¼ï¼šé»˜è®¤éšè—ï¼Œç‚¹å‡»æŸ¥çœ‹
                secretHtml = `<td><span class="secret-mask" onclick="toggleSecret(this, '${s.secret}')" onmouseleave="hideSecret(this)">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></td>`;
            } else {
                // æ™®é€šæ¨¡å¼ï¼šé»˜è®¤ç›´æ¥æ˜¾ç¤ºæ ¼å¼åŒ–åçš„å¯†é’¥ï¼Œæ— ç‚¹å‡»äº‹ä»¶
                let displaySec = s.secret.length <= 6 ? s.secret : s.secret.slice(0, 3) + "â€¢â€¢â€¢â€¢â€¢â€¢" + s.secret.slice(-3);
                secretHtml = `<td><span class="secret-revealed" style="cursor:default;">${displaySec}</span></td>`;
            }

            tr.innerHTML = `
                ${labelHtml}
                <td class="code" style="font-size:${codeFontSize}" onclick="copyCode('${code}')">${code}</td>
                ${secretHtml}
                ${copyHtml}
                ${delHtml}
             `;
            dom.tbody.appendChild(tr);
        }
    }

    window.toggleSecret = function(span, secret) {
        if (span.dataset.revealed === "true") { 
            hideSecret(span);
        } else {
            let display = secret.length <= 4 ? secret : secret.slice(0, 2) + "â€¢â€¢â€¢" + secret.slice(-2);
            span.textContent = display; 
            span.dataset.revealed = "true";
            span.classList.remove('secret-mask'); 
            span.classList.add('secret-revealed');
        }
    };
    
    window.hideSecret = function(span) {
        if (span.dataset.revealed === "true") {
            span.textContent = "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
            span.dataset.revealed = "false";
            span.classList.remove('secret-revealed'); span.classList.add('secret-mask');
        }
    };

    dom.memBtn.onclick = function() {
        if (!isMemEnabled) {
            if (localStorage.getItem(STORAGE_KEY_DATA_ENC)) {
                enableMemoryMode(false);
                return;
            }
            const hasRead = localStorage.getItem(STORAGE_KEY_RISK_READ);
            if (hasRead === "1") {
                dom.setupModal.style.display = "flex";
                setTimeout(()=>dom.setupPass.focus(), 100);
            } else {
                dom.riskModal.style.display = "flex";
            }
        } else {
            disableMemoryMode();
        }
    };

    window.cancelMemSwitch = function() {
        dom.riskModal.style.display = "none";
        dom.riskCheck.checked = false; 
        if(dom.riskInlineError) dom.riskInlineError.style.display = "none";
    };

    window.confirmMemSwitch = function() {
        if (!dom.riskCheck.checked) {
            if(dom.riskInlineError) dom.riskInlineError.style.display = "block";
            return; 
        }

        if (dom.riskCheck.checked) {
            localStorage.setItem(STORAGE_KEY_RISK_READ, "1");
        }
        dom.riskModal.style.display = "none";
        if(dom.riskInlineError) dom.riskInlineError.style.display = "none";
        
        dom.setupModal.style.display = "flex";
        setTimeout(()=>dom.setupPass.focus(), 100);
    };

    dom.riskCheck.onclick = function() {
        if (dom.riskCheck.checked && dom.riskInlineError) {
            dom.riskInlineError.style.display = "none";
        }
    };

    window.cancelSetup = () => { 
        dom.setupModal.style.display = "none"; 
        dom.setupPass.value = ""; 
        if(dom.setupInlineError) dom.setupInlineError.style.display = "none";
    };

    window.confirmSetup = () => {
        const pass = dom.setupPass.value; 
        if (!pass) { 
            if(dom.setupInlineError) dom.setupInlineError.style.display = "block";
            return; 
        }
        currentMasterPass = pass; 
        dom.setupModal.style.display = "none";
        if(dom.setupInlineError) dom.setupInlineError.style.display = "none";
        
        memoryStorage = [];
        saveToStorageEncrypted().then(() => enableMemoryMode(true));
    };
    
    dom.setupPass.oninput = () => {
        if(dom.setupInlineError) dom.setupInlineError.style.display = "none";
    };

    window.switchToRestoreSetup = () => { dom.setupModal.style.display = "none"; openRestoreModal(true); };
    function enableMemoryMode(isUnlocked) {
        isMemEnabled = true; localStorage.setItem(STORAGE_KEY_MEM_FLAG, "1");
        updateUIState(isUnlocked);
        dom.secretBox.value = "";
        if (isUnlocked) { activeSecrets = [...memoryStorage]; refreshTable(); }
        else { currentMasterPass = null;
        activeSecrets = []; refreshTable(); setTimeout(()=>dom.unlockPass.focus(), 100); }
        updatePlaceholder();
    }
    
    function disableMemoryMode() {
        isMemEnabled = false;
        currentMasterPass = null; 
        localStorage.setItem(STORAGE_KEY_MEM_FLAG, "0");
        dom.unlockPass.value = ""; 
        updateUIState(false); 
        dom.overlay.style.display = 'none';
        dom.lockMsg.style.display = 'none';
        dom.emptyTip.style.display = 'none';
        onInputChanged(); 
        updatePlaceholder();
    }
    
    function updateUIState(isUnlocked) {
        dom.memBtn.textContent = isMemEnabled ? "è®°å¿†æ¨¡å¼: å¼€" : "è®°å¿†æ¨¡å¼: å…³";
        dom.memBtn.classList.toggle("mem-active", isMemEnabled);
        
        if (isMemEnabled) {
            dom.section.classList.add("is-memory-active");
            if(isUnlocked) {
                dom.section.classList.add("is-unlocked");
            } else {
                dom.section.classList.remove("is-unlocked");
            }
        } else {
            dom.section.classList.remove("is-memory-active");
            dom.section.classList.remove("is-unlocked");
        }
    }

    window.lockVault = () => { if(isMemEnabled) { currentMasterPass = null;
        activeSecrets = []; dom.unlockPass.value = ""; dom.unlockErr.style.display="none"; updateUIState(false); refreshTable(); showToast("å·²é”å®š"); }};
    window.unlockVault = async () => {
        const pass = dom.unlockPass.value; if(!pass) return;
        try {
            const json = localStorage.getItem(STORAGE_KEY_DATA_ENC);
            if (!json) { memoryStorage = []; currentMasterPass = pass; saveToStorageEncrypted();
            }
            else { const raw = await CryptoUtils.decrypt(json, pass);
            memoryStorage = raw.map(parseLine).filter(Boolean); currentMasterPass = pass; }
            dom.unlockErr.style.display = "none";
            activeSecrets = [...memoryStorage]; 
            updateUIState(true);
            refreshTable(); showToast("è§£å¯†æˆåŠŸ");
        } catch (e) { dom.unlockErr.style.display = "block"; dom.unlockPass.select(); }
    };
    dom.unlockPass.addEventListener("keyup", (e)=>{ if(e.key === "Enter") unlockVault(); });

    window.resetVault = function() {
        if(confirm("ç¡®å®šè¦é‡ç½®å¹¶æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ\nè¿™æ˜¯ã€å¿˜è®°å¯†ç ã€‘çš„å”¯ä¸€è§£å†³åŠæ³•ï¼Œæ•°æ®å°†ä¸¢å¤±ã€‚")) {
            localStorage.removeItem(STORAGE_KEY_DATA_ENC);
            disableMemoryMode();
            showToast("æ•°æ®å·²é‡ç½®");
        }
    };

    window.openExportModal = () => {
        if(!currentMasterPass) { showToast("è¯·å…ˆè§£é”");
        return; }
        const data = localStorage.getItem(STORAGE_KEY_DATA_ENC);
        if(!data) { showToast("æš‚æ— æ•°æ®"); return;
        }
        dom.exportText.value = data; dom.exportModal.style.display = "flex";
    };
    window.closeExportModal = () => dom.exportModal.style.display = "none";
    window.copyBackup = () => { dom.exportText.select(); document.execCommand('copy'); showToast("å·²å¤åˆ¶"); };
    window.downloadBackup = () => {
        const blob = new Blob([dom.exportText.value], {type: "text/plain"});
        const a = document.createElement("a"); a.href = URL.createObjectURL(blob);
        a.download = "2fa_backup_" + new Date().toISOString().slice(0,10) + ".txt"; a.click();
    };
    let isInitRestore = false;
    window.openRestoreModal = (isInit = false) => {
        isInitRestore = isInit;
        if(!isInit && !currentMasterPass) { showToast("è¯·å…ˆè§£é”"); return; }
        dom.restoreText.value = ""; dom.restoreModal.style.display = "flex";
        setTimeout(()=>dom.restoreText.focus(), 100);
    };
    window.closeRestoreModal = () => dom.restoreModal.style.display = "none";
    window.confirmRestore = () => {
        const data = dom.restoreText.value.trim(); if(!data) { showToast("å†…å®¹ä¸ºç©º"); return;
        }
        try { JSON.parse(data); } catch(e) { alert("æ•°æ®æ ¼å¼é”™è¯¯"); return;
        }
        localStorage.setItem(STORAGE_KEY_DATA_ENC, data); dom.restoreModal.style.display = "none";
        if(isInitRestore) { enableMemoryMode(false); showToast("æ¢å¤æˆåŠŸï¼Œè¯·ç”¨åŸå¯†ç è§£é”");
        } 
        else { lockVault(); showToast("æ¢å¤æˆåŠŸï¼Œè¯·é‡æ–°è§£é”"); }
    };
    window.importToMemory = async () => {
        if (!currentMasterPass) { showToast("è¯·å…ˆè§£é”"); return;
        }
        const raw = dom.secretBox.value; if(!raw.trim()) { showToast("è¾“å…¥æ¡†æ˜¯ç©ºçš„"); return;
        }
        const lines = raw.split(/\r?\n/); let added=0;
        lines.forEach(l => {
            const p = parseLine(l);
            if(p) {
                if(!p.label) p.label = "å¯†é’¥ " + (memoryStorage.length + 1);
                p.raw = `otpauth://totp/${encodeURIComponent(p.label)}?secret=${p.secret}`;
                memoryStorage.push(p); added++;
            }
        });
        if(added>0) { 
            await saveToStorageEncrypted();
            activeSecrets = [...memoryStorage]; 
            refreshTable(); 
            dom.secretBox.value=""; 
            showToast(`æ·»åŠ  ${added} ä¸ª`); 
        } else {
            showToast("æœªè¯†åˆ«æœ‰æ•ˆå¯†é’¥");
        }
    };

    async function saveToStorageEncrypted() {
        if (!currentMasterPass) return;
        const list = memoryStorage.map(i => `otpauth://totp/${encodeURIComponent(i.label)}?secret=${i.secret}`);
        localStorage.setItem(STORAGE_KEY_DATA_ENC, await CryptoUtils.encrypt(list, currentMasterPass));
    }

    window.handleCellEdit = async (td, idx) => {
        if(!isMemEnabled || !currentMasterPass) return;
        if(td.querySelector('input')) return;
        const txt = td.innerText; const inp = document.createElement('input'); 
        inp.type = 'text'; inp.value = txt; inp.className = 'inline-edit';
        td.innerHTML = ''; td.appendChild(inp); inp.focus();
        inp.onblur = async () => {
            const val = inp.value.trim();
            if(val && val !== txt) {
                memoryStorage[idx].label = val;
                memoryStorage[idx].raw = `otpauth://totp/${encodeURIComponent(val)}?secret=${memoryStorage[idx].secret}`;
                await saveToStorageEncrypted(); activeSecrets=[...memoryStorage]; refreshTable(); showToast("å·²æ›´æ–°");
            } else refreshTable();
        };
        inp.onkeydown = (e) => { if(e.key==='Enter') inp.blur(); };
    };

    window.deleteRow = async (idx) => {
        if(!confirm("ç¡®å®šè¦åˆ é™¤æ­¤å¯†é’¥å—ï¼Ÿ")) return;
        memoryStorage.splice(idx, 1); await saveToStorageEncrypted();
        activeSecrets=[...memoryStorage]; refreshTable(); showToast("å·²åˆ é™¤");
    };

    window.clearMemoryData = () => {
        if(confirm("âš ï¸ è­¦å‘Šï¼šç¡®å®šæ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼")) {
            localStorage.removeItem(STORAGE_KEY_DATA_ENC);
            memoryStorage=[]; activeSecrets=[];
            disableMemoryMode();
            showToast("æ•°æ®å·²é”€æ¯ï¼Œæ¨¡å¼å·²é‡ç½®");
        }
    };

    dom.tbody.addEventListener('click', (e) => {
        if (['INPUT','BUTTON','SPAN'].includes(e.target.tagName)) return;
        const tr = e.target.closest('tr');
        if (!tr) return;
        dom.tbody.querySelectorAll('.highlighted-row').forEach(row => row.classList.remove('highlighted-row'));
        tr.classList.add('highlighted-row');
    });
    dom.secretBox.addEventListener("input", onInputChanged);
    (function init(){ 
        if(localStorage.getItem(STORAGE_KEY_MEM_FLAG)==="1") {
            if (localStorage.getItem(STORAGE_KEY_DATA_ENC)) {
                enableMemoryMode(false);
            } else {
                disableMemoryMode();
            }
        }
    })();
    setInterval(async ()=>{
      const now=Math.floor(Date.now()/1000); let left=period - (now % period);
      if(left===0) { left=period; await refreshTable(); }
      var t=document.getElementById("timer"); if(t) t.textContent=left;
      document.querySelectorAll("#resultTable .code").forEach(el=>{
        if(left<=5) el.classList.add("blinking"); else el.classList.remove("blinking");
      });
    },1000);
    function copyCode(c){ navigator.clipboard.writeText(c).then(()=>{showToast("å·²å¤åˆ¶: " + c);}); }
    
    // showToast åŠŸèƒ½ (ç”¨äºå…¶ä»–éæ¨¡æ€æç¤º)
    function showToast(msg){ 
        const container = document.getElementById('toast-container');
        if (!container) return;
        const div = document.createElement('div');
        div.className = 'toast-msg';
        div.textContent = msg;
        container.appendChild(div);
        setTimeout(() => { div.remove(); }, 2800);
    }

    function pasteInput(){ navigator.clipboard.readText().then(t=>{ dom.secretBox.value=t; if(!isMemEnabled) onInputChanged(); }); }
    function clearInput(){ dom.secretBox.value="";
    if(!isMemEnabled) onInputChanged(); }
    function setScale(val,font){
      document.getElementById('fa').style.fontSize=val+"%"; codeFontSize=font;
      localStorage.setItem("scalePercent",val); localStorage.setItem("codeFontSize",font);
      document.querySelectorAll(".scale-btn").forEach(b=>b.classList.toggle("active", b.dataset.scale===val));
      refreshTable();
    }
    document.querySelectorAll(".scale-btn").forEach(b=>b.onclick=()=>setScale(b.dataset.scale,b.dataset.font));
    
    // [ä¿®æ”¹] é»˜è®¤å€¼è®¾ä¸ºä¸­å· (150%)
    (function(){ 
        const s=localStorage.getItem("scalePercent")||"150"; 
        const f=localStorage.getItem("codeFontSize")||"1.5em";
        codeFontSize=f; setScale(s,f);
    })();
</script>
</section>

<!-- ================================================================
     >>> è¿™é‡Œæ˜¯é›†æˆåçš„â€œæ–‡æœ¬å·¥å…·ç®±â€åŒºåŸŸ <<<
     æˆ‘å°†å»é‡ã€å¢åŠ ã€åˆ†åˆ—ã€æ‰“ä¹±å››ä¸ªæ¨¡å—æ¬åˆ°äº†è¿™é‡Œ
     ================================================================ -->
<section id="text-tools">

  <!-- å†…éƒ¨æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <div class="tt-tabs">
    <button class="tt-tab active" onclick="switchTextTool('dedupe', this)">æ–‡æœ¬å»é‡</button>
    <button class="tt-tab" onclick="switchTextTool('affix', this)">æ–‡æœ¬å¢åŠ </button>
    <button class="tt-tab" onclick="switchTextTool('split', this)">æ–‡æœ¬åˆ†åˆ—</button>
    <button class="tt-tab" onclick="switchTextTool('shuffle', this)">æ–‡æœ¬æ‰“ä¹±</button>
  </div>

  <!-- A. å»é‡æ¨¡å— -->
  <div id="dedupe" class="tt-pane active">
    <div class="card"><div class="hd">è¾“å…¥</div><div class="bd">
    <textarea id="dedupeIn"></textarea>
    <label><input checked="" id="trimDedupe" type="checkbox"/> å»é™¤ç©ºè¡Œ/ç©ºæ ¼</label>
    <label><input id="caseDedupe" type="checkbox"/> å¿½ç•¥å¤§å°å†™</label>
    </div></div>
    <div class="card"><div class="hd">ç»“æœ</div><div class="bd">
    <div class="btnbar">
    <button class="btn primary" id="dedupeRun">å¤„ç†</button><button class="btn" id="dedupeCopy">å¤åˆ¶</button><button class="btn" id="dedupeTxt">å¯¼å‡º TXT</button><button class="btn" id="dedupeXlsx">å¯¼å‡º XLSX</button><button class="btn" id="dedupeClear">æ¸…ç©º</button></div>
    <div class="stat" id="dedupeStat">â€”</div>
    <textarea id="dedupeOut" readonly=""></textarea>
    </div></div>
  </div>

  <!-- B. å¢åŠ æ¨¡å— -->
  <div id="affix" class="tt-pane">
    <div class="card"><div class="hd">è¾“å…¥</div><div class="bd">
    <textarea id="affixIn"></textarea>
    <input id="affixStr" placeholder="å¢åŠ çš„å†…å®¹" type="text"/>
    <label><input checked="" name="affixSide" type="radio" value="left"/> å‰ç¼€</label>
    <label><input name="affixSide" type="radio" value="right"/> åç¼€</label>
    </div></div>
    <div class="card"><div class="hd">ç»“æœ</div><div class="bd">
    <div class="btnbar">
    <button class="btn primary" id="affixRun">å¤„ç†</button><button class="btn" id="affixCopy">å¤åˆ¶</button><button class="btn" id="affixTxt">å¯¼å‡º TXT</button><button class="btn" id="affixXlsx">å¯¼å‡º XLSX</button><button class="btn" id="affixClear">æ¸…ç©º</button></div>
    <div class="stat" id="affixStat">â€”</div>
    <textarea id="affixOut" readonly=""></textarea>
    </div></div>
  </div>

  <!-- C. åˆ†åˆ—æ¨¡å— -->
  <div id="split" class="tt-pane">
    <div class="card"><div class="hd">è¾“å…¥</div><div class="bd">
    <textarea id="splitIn"></textarea>
    <input id="splitSep" placeholder="åˆ†éš”ç¬¦ï¼Œå¦‚ ---- , |" type="text"/>
    </div></div>
    <div class="card"><div class="hd">ç»“æœ</div><div class="bd">
    <div class="btnbar">
    <button class="btn primary" id="splitRun">å¤„ç†</button><button class="btn" id="splitCopy">å¤åˆ¶</button><button class="btn" id="splitTxt">å¯¼å‡º TXT</button><button class="btn" id="splitXlsx">å¯¼å‡º XLSX</button><button class="btn" id="splitClear">æ¸…ç©º</button></div>
    <div class="stat" id="splitStat">â€”</div>
    <div id="splitTableWrap" style="overflow:auto; max-height:250px">
    <table id="splitTable"></table>
    </div>
    </div></div>
  </div>

  <!-- D. æ‰“ä¹±æ¨¡å— -->
  <div id="shuffle" class="tt-pane">
      <div class="card">
        <div class="hd">è¾“å…¥</div>
        <div class="bd">
          <textarea id="shuffleIn" placeholder=""></textarea>
        </div>
      </div>
      <div class="card">
        <div class="hd">ç»“æœ</div>
        <div class="bd">
          <div class="btnbar">
            <button class="btn primary" id="shuffleRun">éšæœºæ‰“ä¹±</button>
            <button class="btn" id="shuffleCopy">å¤åˆ¶</button>
            <button class="btn" id="shuffleTxt">å¯¼å‡º TXT</button>
            <button class="btn" id="shuffleXlsx">å¯¼å‡º XLSX</button>
            <button class="btn" id="shuffleClear">æ¸…ç©º</button>
          </div>
          <div class="stat" id="shuffleStat">â€”</div>
          <textarea id="shuffleOut" readonly></textarea>
        </div>
      </div>
      
      <script>
        // Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
        }

        document.getElementById('shuffleRun').onclick = () => {
          const raw = document.getElementById('shuffleIn').value;
          // æŒ‰è¡Œåˆ†å‰²ï¼Œè‡ªåŠ¨å»é™¤é¦–å°¾ç©ºæ ¼å¹¶ç§»é™¤ç©ºè¡Œ
          let lines = raw.split(/\r?\n/).map(s => s.trim()).filter(s => s !== '');
          
          if (lines.length < 1) {
            toast('æ²¡æœ‰å†…å®¹å¯æ‰“ä¹±');
            return;
          }

          const shuffled = shuffleArray([...lines]); // åˆ›å»ºå‰¯æœ¬è¿›è¡Œæ‰“ä¹±
          document.getElementById('shuffleOut').value = shuffled.join('\n');
          document.getElementById('shuffleStat').textContent = `å…± ${lines.length} è¡Œå·²é‡æ–°æ’åº`;
          toast('æ‰“ä¹±å®Œæˆ');
        };

        document.getElementById('shuffleCopy').onclick = () => {
          const val = document.getElementById('shuffleOut').value;
          if(!val) return toast('ç»“æœä¸ºç©º');
          navigator.clipboard.writeText(val);
          toast('å·²å¤åˆ¶');
        };

        document.getElementById('shuffleTxt').onclick = () => {
          const val = document.getElementById('shuffleOut').value;
          if(!val) return toast('ç»“æœä¸ºç©º');
          saveTxt(`æ–‡æœ¬æ‰“ä¹±${fileTimestamp()}.txt`, val);
        };

        document.getElementById('shuffleXlsx').onclick = () => {
          const val = document.getElementById('shuffleOut').value;
          if(!val) return toast('ç»“æœä¸ºç©º');
          const rows = [['ç»“æœ'], ...val.split('\n').map(v => [v])];
          aoaToXlsx(rows, `æ–‡æœ¬æ‰“ä¹±${fileTimestamp()}.xlsx`);
        };

        document.getElementById('shuffleClear').onclick = () => {
          document.getElementById('shuffleIn').value = '';
          document.getElementById('shuffleOut').value = '';
          document.getElementById('shuffleStat').textContent = 'â€”';
        };
      </script>
  </div>
  
  <script>
    // ç®€å•çš„ Tab åˆ‡æ¢è„šæœ¬
    function switchTextTool(id, btn) {
        document.querySelectorAll('#text-tools .tt-pane').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('#text-tools .tt-tab').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }
  </script>
</section>

<section id="passwd">
  <div class="pwd-layout-container">
    <!-- å·¦ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="card">
      <div class="hd">è®¾ç½®</div>
      <div class="bd">
        <!-- é•¿åº¦æ§åˆ¶ -->
        <div class="pwd-opt-row">
          <label>å¯†ç é•¿åº¦</label>
          <div style="flex:1; margin:0 15px;">
            <input type="range" id="lenRange" class="pwd-range" min="4" max="32" value="14">
          </div>
          <input id="pwdLen" type="number" value="14" min="4" max="64" style="width:50px; text-align:center; padding:6px;">
        </div>

        <!-- å¼€å…³é€‰é¡¹ -->
        <div class="pwd-opt-row">
          <label>A-Z (å¤§å†™å­—æ¯)</label>
          <label class="switch-toggle">
            <input type="checkbox" id="pwdUpper" checked>
            <span class="slider-toggle"></span>
          </label>
        </div>

        <div class="pwd-opt-row">
          <label>0-9 (æ•°å­—)</label>
          <label class="switch-toggle">
            <input type="checkbox" id="pwdNum" checked>
            <span class="slider-toggle"></span>
          </label>
        </div>

        <div class="pwd-opt-row">
          <label>!@# (ç‰¹æ®Šç¬¦å·)</label>
          <label class="switch-toggle">
            <input type="checkbox" id="pwdSym">
            <span class="slider-toggle"></span>
          </label>
        </div>

        <div class="pwd-opt-row">
          <label>ç”Ÿæˆæ•°é‡</label>
          <!-- è¿™é‡Œå°†é»˜è®¤å€¼ä¿®æ”¹ä¸ºäº† 10 -->
          <input id="pwdCount" type="number" value="10" min="1" max="50" style="width:60px; text-align:center; padding:6px;">
        </div>

        <button class="btn primary" id="pwdRun" style="width:100%; margin-top:10px;">ç”Ÿæˆ</button>
      </div>
    </div>

    <!-- å³ä¾§ï¼šç»“æœé¢æ¿ -->
    <div class="card" style="display:flex; flex-direction:column;">
      <div class="hd">ç»“æœ</div>
      <div class="bd" style="flex:1; display:flex; flex-direction:column;">
        <textarea id="pwdOut" readonly style="flex:1; resize:none; margin-bottom:10px; font-family:monospace; height:220px;"></textarea>
        
        <div class="strength-bar">
          <div class="strength-fill" id="strengthFill"></div>
        </div>

        <div class="btnbar" style="margin-top:10px;">
          <button class="btn" id="pwdCopy">å¤åˆ¶</button>
          <button class="btn" id="pwdTxt">å¯¼å‡º TXT</button>
          <button class="btn" id="pwdXlsx">å¯¼å‡º XLSX</button>
          <button class="btn" id="pwdClear">æ¸…ç©º</button>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
/* ====== ä¸»é¢˜åˆ‡æ¢ ====== */
const themeBtn=document.getElementById('themeToggle');
function setTheme(mode){
  if(mode==='dark'){
    document.body.classList.add('dark');
    if(themeBtn) themeBtn.textContent='ğŸŒ æµ…è‰²æ¨¡å¼';
  } else {
    document.body.classList.remove('dark');
    if(themeBtn) themeBtn.textContent='ğŸŒ™ æš—é»‘æ¨¡å¼';
  }
  localStorage.setItem('tools_theme', mode);
}
if(themeBtn){
  themeBtn.onclick=()=>setTheme(document.body.classList.contains('dark')?'light':'dark');
  setTheme(localStorage.getItem('tools_theme')||'light');
}

/* ====== å…¬å…±å‡½æ•° ====== */
function toast(msg){
  const box=document.getElementById('toast');
  const div=document.createElement('div');
  div.className='toast';div.textContent=msg;
  box.appendChild(div); requestAnimationFrame(()=>div.classList.add('show'));
  setTimeout(()=>{div.classList.remove('show'); setTimeout(()=>div.remove(),200)},1500);
}
function fileTimestamp(){
  const d=new Date(),p=n=>String(n).padStart(2,'0');
  return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
}
function saveTxt(name,content){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([content],{type:'text/plain'}));
  a.download=name;a.click();URL.revokeObjectURL(a.href);
}
function aoaToXlsx(rows,name){
  if(typeof XLSX==='undefined'){toast('æœªåŠ è½½XLSXåº“');return;}
  const wb=XLSX.utils.book_new();
  const ws=XLSX.utils.aoa_to_sheet(rows);
  const colWidths=[];
  rows.forEach(r=>{r.forEach((cell,i)=>{const len=String(cell||'').length;colWidths[i]=Math.max(colWidths[i]||10,len+2);});});
  ws['!cols']=colWidths.map(w=>({wch:w}));
  XLSX.utils.book_append_sheet(wb,ws,'Sheet1');XLSX.writeFile(wb,name);
}

/* ====== å»é‡ ====== */
document.getElementById('dedupeRun').onclick=()=>{
  let lines=document.getElementById('dedupeIn').value.split(/\r?\n/);
  if(document.getElementById('trimDedupe').checked) lines=lines.map(s=>s.trim()).filter(s=>s);
  const seen=new Set(),out=[];
  for(const s of lines){const k=document.getElementById('caseDedupe').checked?s.toLowerCase():s;
    if(!seen.has(k)){seen.add(k);out.push(s);}
  }
  document.getElementById('dedupeOut').value=out.join('\n');
  document.getElementById('dedupeStat').textContent=`åŸ${lines.length}è¡Œ â†’ å»é‡å${out.length}è¡Œ`;
  toast('å»é‡å®Œæˆ');
};
document.getElementById('dedupeCopy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('dedupeOut').value);toast('å·²å¤åˆ¶');};
document.getElementById('dedupeTxt').onclick=()=>saveTxt(`æ–‡æœ¬å»é‡å¤${fileTimestamp()}.txt`,document.getElementById('dedupeOut').value);
document.getElementById('dedupeXlsx').onclick=()=>aoaToXlsx([['ç»“æœ'],...document.getElementById('dedupeOut').value.split('\n').map(v=>[v])],`æ–‡æœ¬å»é‡å¤${fileTimestamp()}.xlsx`);
document.getElementById('dedupeClear').onclick=()=>{document.getElementById('dedupeOut').value='';document.getElementById('dedupeStat').textContent='â€”';};

/* ====== æ‰¹é‡å¢åŠ  ====== */
document.getElementById('affixRun').onclick=()=>{
  let lines=document.getElementById('affixIn').value.split(/\r?\n/).map(s=>s.trim()).filter(s=>s);
  const add=document.getElementById('affixStr').value;
  const side=document.querySelector('input[name="affixSide"]:checked').value;
  const out=lines.map(s=>side==='left'?add+s:s+add);
  document.getElementById('affixOut').value=out.join('\n');
  document.getElementById('affixStat').textContent=`è¾“å…¥${lines.length}è¡Œ â†’ è¾“å‡º${out.length}è¡Œ`;
  toast('æ‰¹é‡å®Œæˆ');
};
document.getElementById('affixCopy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('affixOut').value);toast('å·²å¤åˆ¶');};
document.getElementById('affixTxt').onclick=()=>saveTxt(`æ–‡æœ¬æ‰¹é‡å¢åŠ ${fileTimestamp()}.txt`,document.getElementById('affixOut').value);
document.getElementById('affixXlsx').onclick=()=>aoaToXlsx([['ç»“æœ'],...document.getElementById('affixOut').value.split('\n').map(v=>[v])],`æ–‡æœ¬æ‰¹é‡å¢åŠ ${fileTimestamp()}.xlsx`);
document.getElementById('affixClear').onclick=()=>{document.getElementById('affixOut').value='';document.getElementById('affixStat').textContent='â€”';};

/* ====== åˆ†åˆ— ====== */
function buildSplitTable(rows){
  const table=document.getElementById('splitTable');
  table.innerHTML='';
  if(!rows.length){window.splitRows=[];window.splitColCount=0;return;}
  const colCount=Math.max(...rows.map(r=>r.length));
  const normalized=rows.map(r=>Array.from({length:colCount},(_,i)=>r[i]??''));
  const colgroup=document.createElement('colgroup');
  for(let i=0;i<colCount;i++){const col=document.createElement('col');col.style.width=`${100/colCount}%`;colgroup.appendChild(col);}
  table.appendChild(colgroup);
  const thead=document.createElement('thead');const trh=document.createElement('tr');
  for(let i=0;i<colCount;i++){const th=document.createElement('th');th.textContent=`åˆ—${i+1}`;trh.appendChild(th);}
  thead.appendChild(trh);table.appendChild(thead);
  const tbody=document.createElement('tbody');
  normalized.forEach(r=>{const tr=document.createElement('tr');r.forEach(cell=>{const td=document.createElement('td');td.textContent=cell;tr.appendChild(td)});tbody.appendChild(tr);});
  table.appendChild(tbody);
  window.splitRows=normalized;window.splitColCount=colCount;
}
document.getElementById('splitRun').onclick=()=>{
  const sep=document.getElementById('splitSep').value;if(!sep){toast('è¯·è¾“å…¥åˆ†éš”ç¬¦');return;}
  const lines=document.getElementById('splitIn').value.split(/\r?\n/).filter(s=>s);
  const rows=lines.map(l=>l.split(sep).map(c=>c.trim()));
  buildSplitTable(rows);
  document.getElementById('splitStat').textContent=`è¡Œ ${rows.length} ï½œ æœ€å¤§åˆ—æ•° ${window.splitColCount}`;
  toast('åˆ†åˆ—å®Œæˆ');
};
document.getElementById('splitCopy').onclick=()=>{const rows=window.splitRows||[];if(!rows.length){toast('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®');return;}navigator.clipboard.writeText(rows.map(r=>r.join('\t')).join('\n'));toast('å·²å¤åˆ¶TSV');};
document.getElementById('splitTxt').onclick=()=>{const rows=window.splitRows||[];if(!rows.length){toast('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');return;}saveTxt(`æ–‡æœ¬åˆ†åˆ—${fileTimestamp()}.txt`,rows.map(r=>r.join('\t')).join('\n'));};
document.getElementById('splitXlsx').onclick=()=>{const rows=window.splitRows||[];const colCount=window.splitColCount||0;if(!rows.length||!colCount){toast('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');return;}const header=Array.from({length:colCount},(_,i)=>`åˆ—${i+1}`);const data=[header,...rows];aoaToXlsx(data,`æ–‡æœ¬åˆ†åˆ—${fileTimestamp()}.xlsx`);};
document.getElementById('splitClear').onclick=()=>{document.getElementById('splitTable').innerHTML='';document.getElementById('splitStat').textContent='â€”';};

/* ====== å¯†ç ç”Ÿæˆ (å®æ—¶æ›´æ–°) ====== */
function genPwd(len,upper,num,sym){
  let lower='abcdefghijklmnopqrstuvwxyz';
  let chars=lower;
  if(upper) chars+=lower.toUpperCase();
  if(num) chars+='0123456789';
  if(sym) chars+='!@#'; // é™åˆ¶ç¬¦å·
  
  if(!chars) return '';
  let pwd='';
  for(let i=0;i<len;i++) {
    pwd+=chars[Math.floor(Math.random()*chars.length)];
  }
  return pwd;
}

function evalStrength(pwd,upper,num,sym){
  let score=0;
  if(pwd.length>=12) score++;
  if(upper) score++;
  if(num) score++;
  if(sym) score++;
  return score;
}

function autoGen() {
  const len = +document.getElementById('pwdLen').value;
  const cnt = +document.getElementById('pwdCount').value;
  const upper = document.getElementById('pwdUpper').checked;
  const num = document.getElementById('pwdNum').checked;
  const sym = document.getElementById('pwdSym').checked;
  
  const out=[];
  for(let i=0;i<cnt;i++) out.push(genPwd(len,upper,num,sym));
  
  const resultStr = out.join('\n');
  document.getElementById('pwdOut').value = resultStr;
  
  if(resultStr) {
    const score = evalStrength(out[0],upper,num,sym);
    const bar = document.getElementById('strengthFill');
    bar.className = 'strength-fill';
    if(score<=1){ bar.classList.add('weak'); bar.style.width='33%'; }
    else if(score<=3){ bar.classList.add('medium'); bar.style.width='66%'; }
    else{ bar.classList.add('strong'); bar.style.width='100%'; }
  }
}

// åŒæ­¥æ»‘å—å’Œæ•°å­—è¾“å…¥ + å®æ—¶ç”Ÿæˆ
const lenRange = document.getElementById('lenRange');
const lenInput = document.getElementById('pwdLen');

if(lenRange && lenInput) {
  lenRange.addEventListener('input', (e) => { 
    lenInput.value = e.target.value; 
    autoGen(); 
  });
  lenInput.addEventListener('input', (e) => { 
    lenRange.value = e.target.value; 
    autoGen(); 
  });
}

// ç»‘å®šå…¶ä»–æ§ä»¶çš„å®æ—¶äº‹ä»¶
['pwdUpper', 'pwdNum', 'pwdSym'].forEach(id => {
  document.getElementById(id).addEventListener('change', autoGen);
});
document.getElementById('pwdCount').addEventListener('input', autoGen);

// æŒ‰é’®æ‰‹åŠ¨è§¦å‘
document.getElementById('pwdRun').onclick = () => {
  autoGen();
  toast('å·²åˆ·æ–°');
};

document.getElementById('pwdCopy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('pwdOut').value);toast('å·²å¤åˆ¶');};
document.getElementById('pwdTxt').onclick=()=>saveTxt(`å¯†ç ç”Ÿæˆ${fileTimestamp()}.txt`,document.getElementById('pwdOut').value);
document.getElementById('pwdXlsx').onclick=()=>aoaToXlsx([['å¯†ç '],...document.getElementById('pwdOut').value.split('\n').map(v=>[v])],`å¯†ç ç”Ÿæˆ${fileTimestamp()}.xlsx`);
document.getElementById('pwdClear').onclick=()=>{document.getElementById('pwdOut').value='';document.getElementById('strengthFill').style.width='0';};

</script>
</section>
<!-- =========================================================
     æ–°å¢æ¨¡å—ï¼šè€ƒæ‹‰çœ‹æ¿ - ä¸‰åˆ—ç«–é•¿å¸ƒå±€ (ç¬¬3åˆ—åŠ å®½)
     ========================================================= -->
<section id="koala">
  
  <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
  <div class="card" style="margin-bottom: 15px; padding: 10px 15px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span style="font-weight:bold; font-size:16px;">ğŸª™ ç¡¬å¸æ•°æ®çœ‹æ¿</span>
      <button class="btn" onclick="refreshDune()" style="padding:4px 12px; font-size:12px;">åˆ·æ–°å…¨æ¿æ•°æ®</button>
    </div>
  </div>

  <!-- ä¸‰åˆ—å¸ƒå±€å®¹å™¨ -->
  <div class="dune-triple-grid">
    
    <!-- ã€å›¾è¡¨ 1ã€‘æ™®é€šå®½ -->
    <div class="card dune-col">
      <div class="hd compact-hd">å‘¨æ•°æ® (Part 1)</div>
      <div class="bd compact-bd">
        <iframe id="duneFrame1" class="dune-iframe-tall" src="" frameborder="0" loading="lazy" allowfullscreen></iframe>
      </div>
    </div>

    <!-- ã€å›¾è¡¨ 2ã€‘æ™®é€šå®½ -->
    <div class="card dune-col">
      <div class="hd compact-hd">æ—¥æ•°æ® (Part 2)</div>
      <div class="bd compact-bd">
        <iframe id="duneFrame2" class="dune-iframe-tall" src="" frameborder="0" loading="lazy" allowfullscreen></iframe>
      </div>
    </div>

    <!-- ã€å›¾è¡¨ 3ã€‘åŠ å®½ç‰ˆ (æ”¾åœ°å€) -->
    <div class="card dune-col">
      <div class="hd compact-hd">å½“å‘¨åœ°å€åˆ—è¡¨ (Part 3)</div>
      <div class="bd compact-bd">
        <iframe id="duneFrame3" class="dune-iframe-tall" src="" frameborder="0" loading="lazy" allowfullscreen></iframe>
      </div>
    </div>

  </div>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <div style="margin-top:10px; font-size:12px; color:var(--muted); text-align:center;">
    æ•°æ®æ¥æºï¼šDune Analytics (30åˆ†é’ŸåŒæ­¥)
  </div>

  <!-- æ ·å¼è®¾å®š -->
  <style>
    /* 1. ä¸‰åˆ—å¸ƒå±€æ ¸å¿ƒé…ç½® */
    .dune-triple-grid {
      display: grid;
      /* å…³é”®ç‚¹ï¼š1fr 1fr 1.4fr è¡¨ç¤ºå‰ä¸¤ä¸ªç­‰å®½ï¼Œç¬¬ä¸‰ä¸ªå®½ 1.4å€ */
      grid-template-columns: 1fr 1fr 1.4fr; 
      gap: 12px; /* åˆ—é—´è· */
      align-items: stretch; /* å¼ºåˆ¶é«˜åº¦æ‹‰ä¼¸å¯¹é½ */
    }

    /* 2. å¡ç‰‡æ ·å¼å¾®è°ƒ */
    .compact-hd {
      padding: 8px 10px !important;
      font-size: 14px !important;
      border-bottom: 1px solid #eee;
      white-space: nowrap; 
      overflow: hidden; 
      text-overflow: ellipsis; /* é˜²æ­¢æ ‡é¢˜å¤ªé•¿æ¢è¡Œ */
    }
    .compact-bd {
      padding: 0 !important;
      height: calc(100% - 38px); /* æ‰£é™¤æ ‡é¢˜é«˜åº¦ï¼Œå¡«æ»¡å‰©ä½™ç©ºé—´ */
    }

    /* 3. å›¾è¡¨é«˜åº¦è®¾å®š (ç«–é•¿æ¡) */
    .dune-iframe-tall {
      width: 100%;
      height: 800px; /* è¿™é‡Œè®¾ç½®é«˜åº¦ï¼Œå¦‚æœä¸è´­é•¿å¯ä»¥æ”¹æˆ 900px */
      display: block;
    }

    /* 4. å“åº”å¼é€‚é…ï¼šæ‰‹æœºç«¯å˜æˆå•åˆ—å †å  */
    @media (max-width: 1000px) {
      .dune-triple-grid {
        grid-template-columns: 1fr; /* å˜æˆå•åˆ— */
      }
      .dune-iframe-tall {
        height: 500px; /* æ‰‹æœºä¸Šä¸ç”¨é‚£ä¹ˆé•¿ï¼Œ500å¤Ÿäº† */
      }
    }

    /* 5. æš—é»‘æ¨¡å¼é€‚é… */
    body.dark .compact-hd { border-bottom: 1px solid #444; background: #2a2a2a; }
    body.dark #koala .card { background-color: #2a2a2a !important; border: 1px solid #444 !important; color: #e5e5e5 !important; }
    body.dark #koala .btn { background-color: #3399ff !important; color: white !important; border: none !important; }
  </style>

  <!-- é€»è¾‘è„šæœ¬ -->
  <script>
    (function(){
      // âœ… é…ç½®ï¼š3ä¸ªå›¾è¡¨é“¾æ¥
      // ç¬¬ä¸‰ä¸ªé“¾æ¥æ”¾åˆ°äº†æœ€å®½çš„æ ¼å­é‡Œ
      const charts = [
        { id: 'duneFrame1', url: 'https://dune.com/embeds/6247745/9961500/053658e5-5246-4b9b-8e39-300dcd8faf82' },
        { id: 'duneFrame2', url: 'https://dune.com/embeds/6247801/9961580/ee74f02c-8a8e-483b-94b1-fcebf17db73a' },
        { id: 'duneFrame3', url: 'https://dune.com/embeds/6247803/9961582/85216cfd-a976-4e67-b998-b316d6fab291' }
      ];

      window.refreshDune = function() {
        const isDark = document.body.classList.contains('dark');
        const themeParam = isDark ? "?theme=dark" : "?theme=light";
        const timestamp = "&ts=" + new Date().getTime(); 
        
        charts.forEach(chart => {
          const el = document.getElementById(chart.id);
          if(el) {
            el.src = chart.url + themeParam + timestamp;
          }
        });
      };

      setTimeout(refreshDune, 500);

      const globalToggle = document.getElementById('globalThemeToggle');
      if(globalToggle) {
        globalToggle.addEventListener('click', function(){
          setTimeout(refreshDune, 100); 
        });
      }
      
      document.addEventListener('click', function(e){
        if(e.target && e.target.dataset.tab === 'koala') {
           const firstFrame = document.getElementById('duneFrame1');
           if(!firstFrame.src || firstFrame.src === 'about:blank' || firstFrame.src === '') {
             refreshDune();
           }
        }
      });
    })();
  </script>
</section>

<!-- =========================================================
     æ–°å¢æ¨¡å—ï¼šé’±åŒ…ç”Ÿæˆ (é›†æˆ Demo) - å·²é‡å‘½åIDé˜²æ­¢å†²çª
     ========================================================= -->
<section id="wallet-generator">
    <!-- å®‰å…¨æ£€æµ‹é®ç½© -->
    <div id="wg-networkOverlay">
        <div class="warning-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 1l22 22"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>
        </div>
        <div class="overlay-title">ç¯å¢ƒå®‰å…¨æ£€æµ‹</div>
        <div class="overlay-desc">
            ä¸ºç¡®ä¿ç§é’¥ç”Ÿæˆè¿‡ç¨‹çš„ç»å¯¹å®‰å…¨ï¼Œæœ¬ç¨‹åºä»…å…è®¸åœ¨<b>ç¦»çº¿ç¯å¢ƒ</b>ä¸‹è¿è¡Œã€‚<br>
            è¯·åŠ¡å¿…<b>æ–­å¼€ç½‘ç»œè¿æ¥</b>ï¼ˆæ‹”ç½‘çº¿æˆ–å…³é—­ Wi-Fiï¼‰ã€‚
        </div>
        
        <button id="wg-btnVerify" class="btn-verify">
            <div class="spinner" id="wg-verifySpinner"></div>
            <span id="wg-verifyText">æˆ‘å·²æ–­ç½‘ï¼Œç‚¹å‡»éªŒè¯</span>
        </button>
    </div>

    <div class="wg-container">
        <h1>ETHé’±åŒ…æ‰¹é‡ç”Ÿæˆ</h1>
        <!-- æç¤ºè¯æ›´æ–°ï¼šæ ·å¼ä¼˜åŒ– -->
        <div class="subtitle">æç¤º: é’±åŒ…ç”Ÿæˆè¿‡ç¨‹å‡åœ¨æœ¬åœ°ç¯å¢ƒå®Œæˆï¼Œæˆ‘ä»¬æ— æ³•è·å–åˆ°é’±åŒ…çš„ä»»ä½•ä¿¡æ¯ï¼æ­¤å·¥å…·åœ¨æœ¬åœ°è¿è¡Œï¼Œä¸ºäº†å®‰å…¨ï¼Œè¯·æ–­å¼€ç½‘ç»œå¹¶åœ¨æ— ç—•æµè§ˆå™¨ä¸Šæ‰§è¡Œæ­¤å·¥å…·ï¼</div>

        <div class="toolbar">
            <span class="label">æ•°é‡</span>
            <input type="number" id="wg-inpCount" value="10" min="1">
            
            <button id="wg-btnStart" class="btn-black">å¼€å§‹ç”Ÿæˆ</button>
            <button id="wg-btnStop" class="btn-black btn-stop">åœæ­¢</button>
            
            <span id="wg-statusText" class="toolbar-status">å°±ç»ª</span>
            <span id="wg-badge" class="security-badge bg-safe">OFFLINE</span>
            <button id="wg-btnExport" class="btn-outline" disabled>å¯¼å‡º Excel</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th>#</th><th>åœ°å€ (Address)</th><th>ç§é’¥ (Private Key)</th><th>åŠ©è®°è¯ (Mnemonic)</th></tr>
                </thead>
                <tbody id="wg-tbody"></tbody>
            </table>
        </div>
    </div>
    
    <script>
    (function(){
        // çŠ¶æ€ç®¡ç†
        let isRunning = false;
        let targetTotal = 0;
        let currentCount = 0;
        let walletData = [];
        let startTime = 0;
        let isOfflineConfirmed = false;

        // DOM å…ƒç´  (ä½¿ç”¨ wg- å‰ç¼€)
        const ui = {
            inp: document.getElementById('wg-inpCount'),
            start: document.getElementById('wg-btnStart'),
            stop: document.getElementById('wg-btnStop'),
            export: document.getElementById('wg-btnExport'),
            tbody: document.getElementById('wg-tbody'),
            status: document.getElementById('wg-statusText'),
            overlay: document.getElementById('wg-networkOverlay'),
            badge: document.getElementById('wg-badge'),
            btnVerify: document.getElementById('wg-btnVerify'),
            verifySpinner: document.getElementById('wg-verifySpinner'),
            verifyText: document.getElementById('wg-verifyText')
        };

        // ç½‘ç»œæ¢æµ‹
        function probeUrl(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(true); 
                img.onerror = () => reject(false);
                img.src = url + "?t=" + Date.now();
            });
        }

        async function verifyOfflineStatus() {
            ui.btnVerify.disabled = true;
            ui.btnVerify.classList.remove('error');
            ui.verifySpinner.style.display = 'block';
            ui.verifyText.innerText = "æ­£åœ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒ...";

            const targets = [
                "https://www.baidu.com/favicon.ico",
                "https://www.taobao.com/favicon.ico"
            ];
            
            const probes = targets.map(probeUrl);
            const timeoutPromise = new Promise((_, reject) => {
                // ä¿®æ”¹ï¼šè¶…æ—¶æ—¶é—´ç¼©çŸ­ä¸º 800msï¼ŒåŠ é€Ÿæ£€æµ‹ä½“éªŒ
                setTimeout(() => reject(new Error("TIMEOUT")), 800);
            });

            try {
                await Promise.any(probes);
                // ä»£ç èµ°åˆ°è¿™é‡Œè¯´æ˜ï¼šæ£€æµ‹åˆ°äº†ç½‘ç»œè¿æ¥
                throw new Error("ONLINE_DETECTED");

            } catch (error) {
                if (error.message === "ONLINE_DETECTED") {
                    ui.verifyText.innerText = "éªŒè¯å¤±è´¥ï¼šå½“å‰ç½‘ç»œæš‚æœªå…³é—­";
                    ui.btnVerify.classList.add('error');
                    
                    setTimeout(() => {
                        ui.btnVerify.disabled = false;
                        ui.btnVerify.classList.remove('error');
                        ui.verifySpinner.style.display = 'none';
                        ui.verifyText.innerText = "é‡è¯• (è¯·ç¡®ä¿å·²æ–­ç½‘)";
                    }, 1500);
                } else {
                    // ç¡®è®¤ç¦»çº¿ -> è§£é”
                    isOfflineConfirmed = true;
                    ui.overlay.style.opacity = '0';
                    setTimeout(() => {
                        ui.overlay.classList.add('hidden');
                    }, 300);
                    
                    ui.badge.innerText = 'SECURE OFFLINE';
                    ui.badge.className = 'security-badge bg-safe';
                }
            }
        }

        ui.btnVerify.onclick = verifyOfflineStatus;

        // ç›‘å¬ç³»ç»Ÿäº‹ä»¶
        window.addEventListener('online', () => {
            // åªæœ‰åœ¨å½“å‰æ ‡ç­¾é¡µæ˜¯ wallet-generator æ—¶æ‰è§¦å‘ä¸¥æ ¼æ¨¡å¼
            const walletSection = document.getElementById('wallet-generator');
            if (!walletSection.classList.contains('active')) return;

            isOfflineConfirmed = false;
            ui.overlay.classList.remove('hidden');
            ui.overlay.style.opacity = '1';
            ui.badge.innerText = 'ONLINE DETECTED';
            ui.badge.className = 'security-badge bg-danger';
            
            ui.verifySpinner.style.display = 'none';
            ui.btnVerify.disabled = false;
            ui.btnVerify.classList.remove('error');
            ui.verifyText.innerText = "æˆ‘å·²æ–­ç½‘ï¼Œç‚¹å‡»éªŒè¯";

            if (isRunning) {
                stopGeneration();
                alert("ç¯å¢ƒå®‰å…¨è­¦å‘Šï¼šæ£€æµ‹åˆ°ç½‘ç»œè¿æ¥ï¼Œå·²åœæ­¢è¿è¡Œã€‚");
            }
        });

        // æ ¸å¿ƒç”Ÿæˆé€»è¾‘
        function generateOne() {
            if (!isRunning || currentCount >= targetTotal) { finish(); return; }
            
            const wallet = ethers.Wallet.createRandom();
            currentCount++;
            walletData.push({ id: currentCount, address: wallet.address, privateKey: wallet.privateKey, mnemonic: wallet.mnemonic.phrase });

            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${currentCount}</td><td class="font-mono copyable">${wallet.address}</td><td><div class="blur-text font-mono copyable">${wallet.privateKey}</div></td><td><div class="blur-text copyable">${wallet.mnemonic.phrase}</div></td>`;
            ui.tbody.appendChild(tr);
            ui.status.innerText = `æ­£åœ¨ç”Ÿæˆ... ${currentCount} / ${targetTotal}`;
            if (isRunning) requestAnimationFrame(generateOne); 
        }

        ui.start.onclick = () => {
            if(typeof ethers === 'undefined') return alert('æ ¸å¿ƒåº“æœªåŠ è½½ï¼Œè¯·å…ˆè”ç½‘åˆ·æ–°ï¼Œå†æ–­ç½‘ã€‚');
            const val = parseInt(ui.inp.value);
            if(!val || val <= 0) return;
            targetTotal = val; currentCount = 0; walletData = []; isRunning = true; startTime = performance.now();
            ui.tbody.innerHTML = ''; ui.inp.disabled = true; ui.start.style.display = 'none'; ui.stop.style.display = 'block'; ui.export.disabled = true;
            generateOne();
        };

        function stopGeneration() { isRunning = false; ui.status.innerText = `å·²åœæ­¢ï¼Œå…± ${currentCount} ä¸ª`; resetBtnState(); }
        ui.stop.onclick = stopGeneration;
        function finish() { isRunning = false; const t = ((performance.now() - startTime) / 1000).toFixed(2); ui.status.innerText = `å®Œæˆ ${currentCount} ä¸ªï¼Œè€—æ—¶ ${t} ç§’`; resetBtnState(); }
        function resetBtnState() { ui.inp.disabled = false; ui.start.style.display = 'block'; ui.stop.style.display = 'none'; if (walletData.length > 0) ui.export.disabled = false; }
        
ui.export.onclick = () => {
            const ws = XLSX.utils.json_to_sheet(walletData);
            
            // === æ–°å¢ï¼šè‡ªåŠ¨è®¡ç®—åˆ—å®½é€»è¾‘ ===
            if (walletData.length > 0) {
                const keys = Object.keys(walletData[0]); // è·å–è¡¨å¤´ (id, address, privateKey...)
                const colWidths = keys.map(key => {
                    // éå†æ¯ä¸€åˆ—æ•°æ®ï¼Œæ‰¾å‡ºæœ€é•¿çš„å†…å®¹
                    const maxLen = walletData.reduce((max, row) => {
                        const cellStr = row[key] ? String(row[key]) : "";
                        // å¦‚æœå†…å®¹ä¸­æœ‰ä¸­æ–‡ï¼Œé•¿åº¦è®¡ç®—å¯èƒ½éœ€è¦è°ƒæ•´ï¼Œä½†è¿™é‡Œä¸»è¦æ˜¯å­—æ¯æ•°å­—ï¼Œç›´æ¥å– length å³å¯
                        return Math.max(max, cellStr.length);
                    }, key.length); // åˆå§‹å®½åº¦è‡³å°‘è¦åŒ…å«è¡¨å¤´æ–‡å­—é•¿åº¦
                    return { wch: maxLen + 2 }; // +2 ä¸ºäº†ç¨å¾®ç•™ç‚¹ç©ºéš™
                });
                ws['!cols'] = colWidths;
            }
            // === ç»“æŸ ===

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Wallets"); 
            XLSX.writeFile(wb, `Batch_Gen_${currentCount}.xlsx`);
        };

        // å¤åˆ¶åŠŸèƒ½
        ui.tbody.addEventListener('click', async (e) => {
            const target = e.target.closest('.copyable');
            if (target) {
                try { 
                    await navigator.clipboard.writeText(target.innerText); 
                    // ä½¿ç”¨ä¸»ç«™çš„ toast å‡½æ•°
                    if(window.showToast) window.showToast(`å·²å¤åˆ¶`); 
                } catch (err) {}
            }
        });

        // åˆå§‹åŒ–æ£€æµ‹ï¼šæ¯æ¬¡åˆ‡å› tab æ—¶ï¼Œå¦‚æœæ˜¯è”ç½‘çŠ¶æ€ï¼Œåº”è¯¥æ˜¾ç¤ºé®ç½©
        const navBtn = document.querySelector('button[data-tab="wallet-generator"]');
        if(navBtn) {
            navBtn.addEventListener('click', function() {
                if(navigator.onLine && !isOfflineConfirmed) {
                   ui.overlay.classList.remove('hidden');
                   ui.overlay.style.opacity = '1';
                }
            });
        }
    })();
    </script>
</section>
</main>




<script>
(function(){
  function initScale(){
    const savedScale = localStorage.getItem("scalePercent") || "100";
    const savedFont = localStorage.getItem("codeFontSize") || "1.2em";
    if(typeof setScale==='function'){
      setScale(savedScale, savedFont);
    }
    // highlight correct button
    document.querySelectorAll("#scaleBtns button").forEach(btn=>{
      if(btn.dataset.scale===savedScale && btn.dataset.font===savedFont){
        btn.classList.add("active");
      } else {
        btn.classList.remove("active");
      }
    });
  }

  function initTheme(){
    const savedTheme = localStorage.getItem("tools_theme")||"light";
    if(typeof setTheme==='function'){
      if (document.getElementById('themeToggle')) { setTheme(savedTheme); }
    }
  }

  // åˆå§‹åŒ–
  initScale();
  initTheme();
})();

// å…¨å±€ä¸»é¢˜åˆ‡æ¢
document.addEventListener('DOMContentLoaded', function() {
    const globalThemeToggle = document.getElementById('globalThemeToggle');
  if (globalThemeToggle) {
    globalThemeToggle.addEventListener('click', function() {
      document.body.classList.toggle('dark');
      const isDarkMode = document.body.classList.contains('dark');
      localStorage.setItem('tools_theme', isDarkMode ? 'dark' : 'light');
      globalThemeToggle.textContent = isDarkMode ? 'ğŸŒ' : 'ğŸŒ™';
      // >>> æ–°å¢ï¼šåŒæ­¥ 2FA å®¹å™¨çš„æš—è‰²ç±»ï¼Œä¿è¯ä¸å…¨å±€ä¸€è‡´
      (function syncFaToBody(){
        var fa = document.getElementById('fa');
        if(fa){ fa.classList.toggle('dark', isDarkMode); }
      })();
    });

    // Apply saved theme on load
    const savedGlobalTheme = localStorage.getItem('tools_theme');
    if (savedGlobalTheme === 'dark') {
      document.body.classList.add('dark');
      globalThemeToggle.textContent = 'ğŸŒ';
    } else {
      document.body.classList.remove('dark');
      globalThemeToggle.textContent = 'ğŸŒ™';
    }
    // >>> æ–°å¢ï¼šåˆå§‹åŠ è½½æ—¶åŒæ­¥ 2FA å®¹å™¨ä¸å…¨å±€ä¸»é¢˜
    (function syncFaToBodyOnLoad(){
      var fa = document.getElementById('fa');
      if(fa){ fa.classList.toggle('dark', document.body.classList.contains('dark')); }
    })();
    }

  // Ensure the 2FA theme toggle also uses 'tools_theme' for consistency
  const faThemeToggle = document.getElementById('themeToggle');
  if (faThemeToggle) {
    faThemeToggle.addEventListener('click', function() {
      const faElement = document.getElementById('fa');
      faElement.classList.toggle('dark');
      const isDarkMode = faElement.classList.contains('dark');
      localStorage.setItem('tools_theme', isDarkMode ? 'dark' : 'light');
      faThemeToggle.textContent = isDarkMode ? 'ğŸŒ æµ…è‰²æ¨¡å¼' : 'ğŸŒ™ æš—é»‘æ¨¡å¼';
    });

    // Apply saved theme on load for 2FA section
    const savedFaTheme = localStorage.getItem('tools_theme');
    if (savedFaTheme === 'dark') {
      document.getElementById('fa').classList.add('dark');
      faThemeToggle.textContent = 'ğŸŒ æµ…è‰²æ¨¡å¼';
    } else {
      document.getElementById('fa').classList.remove('dark');
      faThemeToggle.textContent = 'ğŸŒ™ æš—é»‘æ¨¡å¼';
    }
  }

});

// ==========================================
// æ–°å¢ï¼šæ”¯æŒ #Hash è·¯ç”±è·³è½¬ä¸çŠ¶æ€è®°å¿† (æ— é—ªçƒç‰ˆ)
// ==========================================
(function() {
  // 1. é…ç½®è·¯ç”±æ˜ å°„è¡¨ï¼š[å†…éƒ¨ID] : [URL Hash]
  const routeMap = {
    'sol': 'sol-account',
    'sol-batch': 'solscan',
    'fa': '2fa',
    'text-tools': 'text-tools',
    'passwd': 'passgen',
    'koala': 'abs',
    'wallet-generator': 'wallet'
  };
  const defaultId = 'sol'; // é»˜è®¤æ˜¾ç¤ºçš„é¡µé¢ID

  // ç”Ÿæˆåå‘æ˜ å°„ç”¨äºæŸ¥æ‰¾ï¼š[URL Hash] : [å†…éƒ¨ID]
  const hashToId = Object.entries(routeMap).reduce((acc, [id, hash]) => {
    acc[hash] = id;
    return acc;
  }, {});

  // 2. ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆåŒ…å« UI åˆ‡æ¢ + URL æ›´æ–°ï¼‰
  const navButtons = document.querySelectorAll('nav button');
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;
      if (!tab) return;
      
      // A. UI åˆ‡æ¢é€»è¾‘
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      const section = document.getElementById(tab);
      if (section) section.classList.add('active');

      // B. URL Hash æ›´æ–°é€»è¾‘
      const targetHash = routeMap[tab];
      if (targetHash) {
        if (location.hash.substring(1) !== targetHash) {
          history.pushState(null, '', '#' + targetHash);
        }
      }
    });
  });

  // 3. æ ¸å¿ƒï¼šé¡µé¢åŠ è½½æ—¶å†³å®šæ˜¾ç¤ºè°
  function applyStateFromHash() {
    const hash = location.hash.substring(1);
    // å¦‚æœæœ‰Hashå°±ç”¨Hashå¯¹åº”çš„IDï¼Œæ²¡æœ‰Hashå°±ç”¨é»˜è®¤çš„ID
    let targetId = hashToId[hash] || defaultId;

    // æ¸…é™¤æ‰€æœ‰activeçŠ¶æ€ï¼ˆåŒé‡ä¿é™©ï¼‰
    navButtons.forEach(b => b.classList.remove('active'));
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));

    // æ‰¾åˆ°ç›®æ ‡æŒ‰é’®å¹¶æ¨¡æ‹Ÿç‚¹å‡»
    // æ¨¡æ‹Ÿç‚¹å‡»æ˜¯æœ€å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒä¼šè§¦å‘ä¸Šé¢ç»‘å®šçš„æ‰€æœ‰é€»è¾‘ï¼ˆåŒ…æ‹¬lazy loadåˆå§‹åŒ–ï¼‰
    const targetBtn = document.querySelector(`nav button[data-tab="${targetId}"]`);
    if (targetBtn) {
      targetBtn.click();
    }
  }

  // ç›‘å¬æµè§ˆå™¨åé€€/å‰è¿›
  window.addEventListener('hashchange', applyStateFromHash);
  
  // ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼ˆä¸ç”¨ç­‰DOMContentLoadedï¼Œå› ä¸ºè„šæœ¬åœ¨åº•éƒ¨ï¼Œå…ƒç´ å·²ç»å­˜åœ¨ï¼‰
  applyStateFromHash();

})();
</script>


<script>
async function loadScriptOnce(src, id){
  return new Promise((resolve, reject)=>{
    if(id && document.getElementById(id)) return resolve();
    const s=document.createElement('script');
    s.src=src; if(id) s.id=id;
    s.onload=()=>resolve(); s.onerror=()=>reject(new Error('Failed to load '+src));
    document.head.appendChild(s);
  });
}
async function ensureSolBatchDeps(){
  if(typeof window.solanaWeb3==='undefined'){
    await loadScriptOnce('https://unpkg.com/@solana/web3.js@1.95.4/lib/index.iife.min.js','solana-web3-iife');
  }
  if(typeof window.XLSX==='undefined'){
    await loadScriptOnce('https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js','xlsx-full');
  }
}


async function initSolBatchTool() {
  await ensureSolBatchDeps();

  if(window.solBatchInited) return;
  window.solBatchInited = true;
  
    const LAMPORTS_PER_SOL = 1_000_000_000n;

    function lamportsToSolString(lam){
      try{
        const b=BigInt(lam); const w=b/LAMPORTS_PER_SOL; const f=b%LAMPORTS_PER_SOL;
        if(f===0n) return w.toString();
        let fs=f.toString().padStart(9,'0'); fs=fs.replace(/0+$/,'');
        return w+'.'+fs;
      }catch{return '0'}
    }

    function parseLines(raw){
      const lines=(raw||'').split(/\r?\n/);
      const items=[];
      for(let i=0;i<lines.length;i++){
        const txt=lines[i].trim();
        if(!txt) continue;
        items.push({ line:i+1, address:txt });
      }
      return items;
    }

    async function copyText(text){
      try{ await navigator.clipboard.writeText(text); return true }catch{ return false }
    }
    function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

    function showToast(message){ try{ toast(message); }catch(e){} }

    const elRpc=document.getElementById('rpc');
    const elRun=document.getElementById('runBtn');
    const elClear=document.getElementById('clearBtn');
    const elExport=document.getElementById('exportXlsxBtn');
    const elCopy=document.getElementById('copyBtn');
    const elSort=document.getElementById('sortBtn');
    const elRetry=document.getElementById('retryFailedBtn');
    const elPing=document.getElementById('pingBtn');
    const elLatency=document.getElementById('latency');
    const elBar=document.getElementById('bar');
    const elValid=document.getElementById('validCount');
    const elSuccess=document.getElementById('successCount');
    const elFail=document.getElementById('failCount');
    const elSum=document.getElementById('sumSol');
    const elMsg=document.getElementById('msg');
    const elList=document.getElementById('list');
    const elThreads=document.getElementById('threads');
    const elDelay=document.getElementById('delay');
    const elTbody=document.getElementById('tbody');
    
    let rows=[];
    let originalRows=[];
    let sorted=false;

    elClear.onclick=()=>{
      elList.value='';elTbody.innerHTML='';rows=[];originalRows=[];sorted=false;
      elBar.style.width='0%';elValid.textContent='0';elSuccess.textContent='0';elFail.textContent='0';
      elSum.textContent='0';elMsg.textContent='';
      elExport.disabled=elCopy.disabled=elSort.disabled=true;
      elSort.textContent='æŒ‰ä½™é¢æ’åº';
      elMsg.classList.remove('error-text');
    };

    elExport.onclick=()=>{
      if(!rows.length) return;
      const wb = XLSX.utils.book_new();
      const sheetData = [['#','åœ°å€','SOL','çŠ¶æ€']];
      rows.forEach(r=>{
        sheetData.push([r.index, r.address, r.sol, r.status]);
      });
      // ç»Ÿè®¡ä¿¡æ¯
      sheetData.push([]);
      sheetData.push(['ç»Ÿè®¡ä¿¡æ¯','æœ‰æ•ˆåœ°å€:'+elValid.textContent,'æˆåŠŸ:'+elSuccess.textContent,'å¤±è´¥:'+elFail.textContent,'æ€»ä½™é¢:'+elSum.textContent+' SOL']);
      const ws = XLSX.utils.aoa_to_sheet(sheetData);
      // è‡ªåŠ¨åˆ—å®½
      const colWidths = sheetData[0].map((_, i) => Math.max(...sheetData.map(row => (row[i] ? String(row[i]).length : 0))) + 2);
      ws['!cols'] = colWidths.map(w => ({ wch: w }));
      XLSX.utils.book_append_sheet(wb, ws, "æŸ¥è¯¢ç»“æœ");
      XLSX.writeFile(wb, `sol-balances-${Date.now()}.xlsx`);
    };

    elCopy.onclick=async()=>{
      if(!rows.length) return;
      const header=['#','Address','SOL','Status'];
      const lines=[header.join('\t')];
      for(const r of rows) lines.push([r.index,r.address,r.sol,r.status].join('\t'));
      if(await copyText(lines.join('\n'))){
        showToast('å¤åˆ¶æˆåŠŸ');
      }else{
        showToast('å¤åˆ¶å¤±è´¥');
      }
    };

    
    // === DO NOT MODIFY START: elRetry.onclick (å¤±è´¥é‡è¯•é€»è¾‘) ===
    elRetry.onclick=async()=>{
      const failedRows = rows.filter(r=>r.status==='å¤±è´¥');
      if(!failedRows.length){ showToast('æ²¡æœ‰å¤±è´¥çš„åœ°å€'); return; }
      elRetry.disabled = true;
      const connection=new solanaWeb3.Connection(elRpc.value.trim(),{commitment:'confirmed'});
      const threads=Math.max(1, Math.min(10, parseInt(elThreads.value)||2));
      const delay=Math.max(0, Math.min(5000, parseInt(elDelay.value)||500));
      let cur=0;
      async function worker(){
        while(cur<failedRows.length){
          const i = cur++;
          const item = failedRows[i];
          try{
            const info = await connection.getAccountInfo(new solanaWeb3.PublicKey(item.address), {commitment:'confirmed'});
            if(info){
              const lam=BigInt(info.lamports);
              const sol=lamportsToSolString(lam);
              rows[item.index-1]={ index:item.index, address:item.address, lamports:lam, sol:sol, status:'æˆåŠŸ' };
              originalRows[item.index-1]=rows[item.index-1];
            }else{
              rows[item.index-1]={ index:item.index, address:item.address, lamports:0n, sol:'0', status:'å¤±è´¥' };
              originalRows[item.index-1]=rows[item.index-1];
            }
          }catch(e){
            rows[item.index-1]={ index:item.index, address:item.address, lamports:0n, sol:'0', status:'å¤±è´¥' };
            originalRows[item.index-1]=rows[item.index-1];
          }
          appendRow(rows[item.index-1], true);
          const sumLam = rows.reduce((acc, r) => acc + (r.lamports || 0n), 0n);
          elSum.textContent = lamportsToSolString(sumLam);
          const validNow = rows.length;
          const succNow = rows.filter(r=>r.status==='æˆåŠŸ').length;
          const failNow = rows.filter(r=>r.status==='å¤±è´¥').length;
          elValid.textContent = String(validNow);
          elSuccess.textContent = String(succNow);
          elFail.textContent = String(failNow);

          await sleep(delay);
        }
      }
      await Promise.all(Array.from({length: threads}, ()=>worker()));
      const sumLam = rows.reduce((acc, r) => acc + (r.lamports || 0n), 0n);
      elSum.textContent = lamportsToSolString(sumLam);
      const _succEnd = rows.filter(r=>r.status==='æˆåŠŸ').length;
      const _failEnd = rows.filter(r=>r.status==='å¤±è´¥').length;
      elSuccess.textContent = String(_succEnd);
      elFail.textContent = String(_failEnd);
      if(rows.filter(r=>r.status==='å¤±è´¥').length===0){ elRetry.style.display='none'; elRetry.disabled=true; }
      showToast('å¤±è´¥åœ°å€å·²é‡è¯•å®Œæˆ');
    };
    // === DO NOT MODIFY END: elRetry.onclick ===

    // === DO NOT MODIFY START: elSort.onclick (æ’åºé€»è¾‘) ===
    elSort.onclick=()=>{
      if(!rows.length) return;
      if(!sorted){
        rows = [...rows].sort((a,b)=>parseFloat(b.sol)-parseFloat(a.sol));
        sorted=true;                       
        renderTable(rows);
        elSort.textContent='æ¢å¤åŸå§‹é¡ºåº';
      }else{
        rows = [...originalRows];
        sorted=false;                      
        renderTable(rows);
        elSort.textContent='æŒ‰ä½™é¢æ’åº';
      }
    };

    elPing.onclick=async()=>{
      const url=elRpc.value;
      const start=performance.now();
      try{
        await fetch(url,{method:'POST',body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getHealth"}),headers:{'Content-Type':'application/json'}});
        const ms=Math.round(performance.now()-start);
        elLatency.textContent=ms+' ms';
      }catch{ elLatency.textContent='è¶…æ—¶'; }
    };

    // === DO NOT MODIFY START: elRun.onclick (åˆå§‹åŒ–é€»è¾‘) ===
    elRun.onclick=async()=>{
      const entries=parseLines(elList.value);
      if(!entries.length){ elMsg.textContent='è¯·è¾“å…¥åœ°å€'; elMsg.classList.remove('error-text'); return; }

      const invalidLines=[];
      for(const it of entries){
        try{ new solanaWeb3.PublicKey(it.address); }
        catch{ invalidLines.push(it.line); }
      }
      if(invalidLines.length){
        elMsg.textContent = 'âš ï¸ ç¬¬ ' + invalidLines.join(', ') + ' è¡Œåœ°å€æ ¼å¼é”™è¯¯ã€‚è¯·åˆ é™¤åå†æŸ¥è¯¢ã€‚';
        elMsg.classList.add('error-text');
        return;
      }

      elRun.disabled=true; elExport.disabled=elCopy.disabled=elSort.disabled=true;
      elTbody.innerHTML=''; rows=[]; originalRows=[]; sorted=false;
      elBar.style.width='0%';
      elValid.textContent=String(entries.length);
      elSuccess.textContent='0'; elFail.textContent='0';
      elSum.textContent='0'; elMsg.textContent='';
      elMsg.classList.remove('error-text');
      elSort.textContent='æŒ‰ä½™é¢æ’åº';

      const threads=Math.max(1, Math.min(10, parseInt(elThreads.value)||2));
      const delay=Math.max(0, Math.min(5000, parseInt(elDelay.value)||500));
      const connection=new solanaWeb3.Connection(elRpc.value.trim(),{commitment:'confirmed'});

      let successCount=0, failCount=0;
      rows = entries.map(it=>({
        index:it.line,
        address:it.address,
        sol:'0',
        status:'ç­‰å¾…'
      }));
      originalRows=[...rows];
      renderTable(rows);
      
      let currentIndex = 0;
      async function worker(){
        while(currentIndex < entries.length){
          const idx = currentIndex++;
          const it = entries[idx];
          try{
            const info = await connection.getAccountInfo(new solanaWeb3.PublicKey(it.address), {commitment:'confirmed'});
            if(info){
              const lam=BigInt(info.lamports);
              const sol=lamportsToSolString(lam);
              rows[idx]={ index:it.line, address:it.address, lamports: lam, sol:sol, status:'æˆåŠŸ' };
              originalRows[idx]=rows[idx];
              successCount++;
              const sumLam = rows.reduce((acc, r) => acc + (r.lamports || 0n), 0n);
              elSum.textContent = lamportsToSolString(sumLam);
            }else{
              rows[idx]={ index:it.line, address:it.address, lamports:0n, sol:'0', status:'å¤±è´¥' };
              originalRows[idx]=rows[idx];
              failCount++;
            }
          }catch(e){
            rows[idx]={ index:it.line, address:it.address, lamports:0n, sol:'0', status:'å¤±è´¥' };
            originalRows[idx]=rows[idx];
            failCount++;
          }
          elBar.style.width = Math.round(((successCount+failCount)/entries.length)*100)+'%';
          elSuccess.textContent = String(successCount);
          elFail.textContent = String(failCount);
          renderTable(rows);
          await sleep(delay);
        }
      }
      await Promise.all(Array.from({length: threads}, ()=>worker()));
      elRun.disabled=false; elExport.disabled=elCopy.disabled=elSort.disabled=false;
      if(rows.filter(r=>r.status==='å¤±è´¥').length>0){ elRetry.style.display='inline-block'; elRetry.disabled=false; }
      showToast('æŸ¥è¯¢å®Œæˆ');
    };
    // === DO NOT MODIFY END: elRun.onclick ===

    function renderTable(data){
      elTbody.innerHTML='';
      data.forEach(r=>appendRow(r));
    }

    function appendRow(r, replace=false){
      if(replace){
        const existingRow = elTbody.querySelector(`tr[data-index="${r.index}"]`);
        if(existingRow) existingRow.remove();
      }
      const tr=document.createElement('tr');
      tr.setAttribute('data-index', r.index);
      tr.innerHTML=`<td>${r.index}</td><td>${r.address}</td><td>${r.sol}</td><td><span class="tag tag-${r.status==='æˆåŠŸ'?'success':r.status==='å¤±è´¥'?'fail':'wait'}">${r.status}</span></td>`;
      elTbody.appendChild(tr);
    }

    function toast(msg){
      const t=document.getElementById('toast');
      if(!t) return;
      t.textContent=msg; t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'),2000);
    }
}

// å½“åˆ‡æ¢åˆ° SOL æ‰¹é‡æŸ¥è¯¢æ ‡ç­¾æ—¶åˆå§‹åŒ–
(function(){
  const solBatchBtn = document.querySelector('button[data-tab="sol-batch"]');
  if (solBatchBtn) {
    // 1. ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆç”¨äºåç»­æ‰‹åŠ¨åˆ‡æ¢ï¼‰
    solBatchBtn.addEventListener('click', initSolBatchTool);

    // 2. ä¿®å¤ Bugï¼šæ£€æŸ¥å½“å‰æ˜¯å¦ç›´æ¥é€šè¿‡ #solscan è¿›å…¥ï¼Œæˆ–è€…æ˜¯å·²æ¿€æ´»çŠ¶æ€
    if (location.hash === '#solscan' || solBatchBtn.classList.contains('active')) {
       initSolBatchTool();
    }
  }
})();
</script>

<script>
// === Global toast implementation ===
function showToast(msg){
  try{
    var box = document.getElementById('toast-container-global');
    if(!box){
      box = document.createElement('div');
      box.id = 'toast-container-global';
      document.body.appendChild(box);
    }
    var item = document.createElement('div');
    item.className = 'toast';
    item.textContent = msg || '';
    box.appendChild(item);
    // Remove after animation
    setTimeout(function(){ if(item && item.parentNode){ item.parentNode.removeChild(item); } }, 2000);
  }catch(e){ console && console.warn && console.warn('toast error:', e); }
}
// === Shims for legacy calls ===
window.toast = function(msg){ showToast(msg); };
window.copyToast = function(msg){ showToast(msg || 'å·²å¤åˆ¶'); };
window.successToast = function(msg){ showToast(msg || 'æˆåŠŸ'); };
</script>

<script>
// === å®‰å…¨å¢é‡ï¼šæ‰‹æœºç«¯ä¸‹æ‹‰èœå•ï¼ˆä¸ç ´ååŸæœ‰åˆ‡æ¢ï¼‰ ===
document.addEventListener("DOMContentLoaded", function() {
  try {
    var nav = document.querySelector("nav");
    if (!nav) return;

    // è‹¥å·²ç»åˆå§‹åŒ–è¿‡åˆ™è·³è¿‡
    if (nav.dataset.dropdownInited === "1") return;
    nav.dataset.dropdownInited = "1";

    // åˆ›å»ºé¡¶éƒ¨ â‰¡ æŒ‰é’®ï¼ˆæ”¾åœ¨ h2 å†…å³ä¾§ï¼‰
    var h2 = nav.querySelector("h2");
    if (!h2) {
      h2 = document.createElement("h2");
      h2.textContent = "åŠŸèƒ½å¯¼èˆª";
      nav.insertBefore(h2, nav.firstChild);
    }
    if (!h2.querySelector(".menu-toggle")) {
      var mt = document.createElement("span");
      mt.className = "menu-toggle";
      mt.textContent = "â‰¡";
      h2.appendChild(mt);
    }

    // åŒ…ä¸€å±‚ .menu-items å®¹å™¨ï¼Œåªæ”¶æ‹¢æŒ‰é’®å’Œ <hr>
    if (!nav.querySelector(".menu-items")) {
      var wrap = document.createElement("div");
      wrap.className = "menu-items";

      var movable = [];
      Array.prototype.forEach.call(nav.children, function(el) {
        if (el.tagName === "BUTTON" || el.tagName === "HR") movable.push(el);
      });
      movable.forEach(function(el){ wrap.appendChild(el); });
      nav.appendChild(wrap);
    }

    var menuToggle = nav.querySelector(".menu-toggle");
    var menuItems = nav.querySelector(".menu-items");

    if (menuToggle && menuItems) {
      menuToggle.addEventListener("click", function() {
        menuItems.classList.toggle("open");
      });
    }

    // åœ¨ç§»åŠ¨ç«¯ç‚¹å‡»ä»»æ„å¯¼èˆªæŒ‰é’®åè‡ªåŠ¨æ”¶èµ·
    nav.addEventListener("click", function(e) {
      var btn = e.target.closest("button[data-tab]");
      if (btn && menuItems && window.matchMedia("(max-width: 768px)").matches) {
        menuItems.classList.remove("open");
      }
    });
  } catch (err) {
    console.error("Mobile dropdown init error:", err);
  }
});
</script>
</body>
</html>
